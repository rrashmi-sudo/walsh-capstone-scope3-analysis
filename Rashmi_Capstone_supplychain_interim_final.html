<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>40aaae10df994e47bb6695cf7f9c3391</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section
id="title-strategic-optimization-of-supply-chain-sustainability-through-sector-based-greenhouse-gas-emission-analysis"
class="cell markdown" id="bykKe-27eSN1">
<h2><strong>Title: Strategic Optimization of Supply Chain Sustainability
through Sector-Based Greenhouse Gas Emission Analysis</strong></h2>
<p>#R Rashmi</p>
</section>
<div class="cell code" id="IuQ20JV7ey2V">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_squared_error</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Set display options</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&#39;display.max_columns&#39;</span>, <span class="va">None</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&#39;display.max_rows&#39;</span>, <span class="dv">50</span>)</span></code></pre></div>
</div>
<section id="scope-and-objectives" class="cell markdown"
id="uG_S3RSogjtf">
<h1><strong>Scope and objectives</strong></h1>
</section>
<div class="cell markdown" id="WFzVts1AgokY">
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="header">
<th>Question no.</th>
<th>Research Questions</th>
<th>Methods</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Is there a statistically significant difference in mean SEF between
Manufacturing (NAICS 31-33) and Services (NAICS 51-56) commodities?</td>
<td>An Independent Samples T-Test (or Mann-Whitney U test if data is
non-normal) will test the null hypothesis (H₀: μ_Mfg = μ_Svc)</td>
</tr>
<tr class="even">
<td>2</td>
<td>To what extent does the Margin Emission Factor (MEF) correlate with
the base Supply Chain Emission Factor (SEF)?</td>
<td>Pearson Correlation Coefficient and scatter plot visualization</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Can a commodity's total CO2e intensity be accurately predicted using
the intensities of specific non-CO2 gases (CH₄, N₂O)?</td>
<td>A Random Forest Regression model will be trained with normalized CH₄
and N₂O intensities as features and the Total EF as the target</td>
</tr>
<tr class="even">
<td>4</td>
<td>Can U.S. commodities be segmented into distinct "Carbon Risk
clusters" based on their combined SEF and MEF profiles?</td>
<td>K-Means Clustering on Z-score standardized SEF and MEF values</td>
</tr>
</tbody>
</table>
</div>
<div class="cell markdown" id="ZfQMObW8ex-m">
<p>#<strong>Data Loading, preparation and Exploration.</strong></p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:74}"
id="6CJCP85gVbwo" data-outputId="e369d7ba-c9e0-426e-da81-08735d14b556">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> files</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>uploaded <span class="op">=</span> files.upload()</span></code></pre></div>
<div class="output display_data">

     <input type="file" id="files-cc1ffa80-38d7-48d0-8130-0c7277887335" name="files[]" multiple disabled
        style="border:none" />
     <output id="result-cc1ffa80-38d7-48d0-8130-0c7277887335">
      Upload widget is only available when the cell has been executed in the
      current browser session. Please rerun this cell to enable.
      </output>
      <script>// Copyright 2017 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Helpers for google.colab Python module.
 */
(function(scope) {
function span(text, styleAttributes = {}) {
  const element = document.createElement('span');
  element.textContent = text;
  for (const key of Object.keys(styleAttributes)) {
    element.style[key] = styleAttributes[key];
  }
  return element;
}

// Max number of bytes which will be uploaded at a time.
const MAX_PAYLOAD_SIZE = 100 * 1024;

function _uploadFiles(inputId, outputId) {
  const steps = uploadFilesStep(inputId, outputId);
  const outputElement = document.getElementById(outputId);
  // Cache steps on the outputElement to make it available for the next call
  // to uploadFilesContinue from Python.
  outputElement.steps = steps;

  return _uploadFilesContinue(outputId);
}

// This is roughly an async generator (not supported in the browser yet),
// where there are multiple asynchronous steps and the Python side is going
// to poll for completion of each step.
// This uses a Promise to block the python side on completion of each step,
// then passes the result of the previous step as the input to the next step.
function _uploadFilesContinue(outputId) {
  const outputElement = document.getElementById(outputId);
  const steps = outputElement.steps;

  const next = steps.next(outputElement.lastPromiseValue);
  return Promise.resolve(next.value.promise).then((value) => {
    // Cache the last promise value to make it available to the next
    // step of the generator.
    outputElement.lastPromiseValue = value;
    return next.value.response;
  });
}

/**
 * Generator function which is called between each async step of the upload
 * process.
 * @param {string} inputId Element ID of the input file picker element.
 * @param {string} outputId Element ID of the output display.
 * @return {!Iterable<!Object>} Iterable of next steps.
 */
function* uploadFilesStep(inputId, outputId) {
  const inputElement = document.getElementById(inputId);
  inputElement.disabled = false;

  const outputElement = document.getElementById(outputId);
  outputElement.innerHTML = '';

  const pickedPromise = new Promise((resolve) => {
    inputElement.addEventListener('change', (e) => {
      resolve(e.target.files);
    });
  });

  const cancel = document.createElement('button');
  inputElement.parentElement.appendChild(cancel);
  cancel.textContent = 'Cancel upload';
  const cancelPromise = new Promise((resolve) => {
    cancel.onclick = () => {
      resolve(null);
    };
  });

  // Wait for the user to pick the files.
  const files = yield {
    promise: Promise.race([pickedPromise, cancelPromise]),
    response: {
      action: 'starting',
    }
  };

  cancel.remove();

  // Disable the input element since further picks are not allowed.
  inputElement.disabled = true;

  if (!files) {
    return {
      response: {
        action: 'complete',
      }
    };
  }

  for (const file of files) {
    const li = document.createElement('li');
    li.append(span(file.name, {fontWeight: 'bold'}));
    li.append(span(
        `(${file.type || 'n/a'}) - ${file.size} bytes, ` +
        `last modified: ${
            file.lastModifiedDate ? file.lastModifiedDate.toLocaleDateString() :
                                    'n/a'} - `));
    const percent = span('0% done');
    li.appendChild(percent);

    outputElement.appendChild(li);

    const fileDataPromise = new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        resolve(e.target.result);
      };
      reader.readAsArrayBuffer(file);
    });
    // Wait for the data to be ready.
    let fileData = yield {
      promise: fileDataPromise,
      response: {
        action: 'continue',
      }
    };

    // Use a chunked sending to avoid message size limits. See b/62115660.
    let position = 0;
    do {
      const length = Math.min(fileData.byteLength - position, MAX_PAYLOAD_SIZE);
      const chunk = new Uint8Array(fileData, position, length);
      position += length;

      const base64 = btoa(String.fromCharCode.apply(null, chunk));
      yield {
        response: {
          action: 'append',
          file: file.name,
          data: base64,
        },
      };

      let percentDone = fileData.byteLength === 0 ?
          100 :
          Math.round((position / fileData.byteLength) * 100);
      percent.textContent = `${percentDone}% done`;

    } while (position < fileData.byteLength);
  }

  // All done.
  yield {
    response: {
      action: 'complete',
    }
  };
}

scope.google = scope.google || {};
scope.google.colab = scope.google.colab || {};
scope.google.colab._files = {
  _uploadFiles,
  _uploadFilesContinue,
};
})(self);
</script> 
</div>
<div class="output stream stdout">
<pre><code>Saving SupplyChain.xlsx to SupplyChain.xlsx
</code></pre>
</div>
</div>
<div class="cell code" id="VryhtmYmVbwv">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="bu">list</span>(uploaded.keys())[<span class="dv">0</span>]</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="nxhg4EDKVbwy" data-outputId="bce7b3a0-7c97-4cb0-e0a4-ea272a0d91e1">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>xls <span class="op">=</span> pd.ExcelFile(file_path)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="op">=</span> xls.sheet_names</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>sheet_names</span></code></pre></div>
<div class="output execute_result" data-execution_count="4">
<pre><code>[&#39;GHG&#39;, &#39;CO2&#39;]</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="63j5eUvWXShI" data-outputId="10fe683a-7059-4024-e15a-f3258ed7fb96">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_GHG <span class="op">=</span> pd.read_excel(file_path, sheet_name<span class="op">=</span><span class="st">&#39;GHG&#39;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Data shape:&quot;</span>, df_GHG.shape)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">First 5 rows:&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_GHG.head())</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Column names:&quot;</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_GHG.columns.tolist())</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Data types:&quot;</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_GHG.dtypes)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Missing values per column:&quot;</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_GHG.isnull().<span class="bu">sum</span>())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Data shape: (18288, 8)

First 5 rows:
   2017 NAICS Code 2017 NAICS Title                   GHG  \
0           111110  Soybean Farming                HFC-23   
1           111110  Soybean Farming        Carbon dioxide   
2           111110  Soybean Farming             HFC-236fa   
3           111110  Soybean Farming  Carbon tetrafluoride   
4           111110  Soybean Farming                HFC-32   

                           Unit  \
0  kg/2022 USD, purchaser price   
1  kg/2022 USD, purchaser price   
2  kg/2022 USD, purchaser price   
3  kg/2022 USD, purchaser price   
4  kg/2022 USD, purchaser price   

   Supply Chain Emission Factors without Margins  \
0                                   3.230000e-09   
1                                   1.340000e-01   
2                                   1.440000e-10   
3                                   5.130000e-09   
4                                   3.000000e-08   

   Margins of Supply Chain Emission Factors  \
0                              1.340000e-09   
1                              3.780000e-02   
2                              2.020000e-10   
3                              5.970000e-09   
4                              4.200000e-08   

   Supply Chain Emission Factors with Margins Reference USEEIO Code  
0                                4.570000e-09                1111A0  
1                                1.720000e-01                1111A0  
2                                3.450000e-10                1111A0  
3                                1.110000e-08                1111A0  
4                                7.200000e-08                1111A0  

Column names:
[&#39;2017 NAICS Code&#39;, &#39;2017 NAICS Title&#39;, &#39;GHG&#39;, &#39;Unit&#39;, &#39;Supply Chain Emission Factors without Margins&#39;, &#39;Margins of Supply Chain Emission Factors&#39;, &#39;Supply Chain Emission Factors with Margins&#39;, &#39;Reference USEEIO Code&#39;]

Data types:
2017 NAICS Code                                    int64
2017 NAICS Title                                  object
GHG                                               object
Unit                                              object
Supply Chain Emission Factors without Margins    float64
Margins of Supply Chain Emission Factors         float64
Supply Chain Emission Factors with Margins       float64
Reference USEEIO Code                             object
dtype: object

Missing values per column:
2017 NAICS Code                                  0
2017 NAICS Title                                 0
GHG                                              0
Unit                                             0
Supply Chain Emission Factors without Margins    0
Margins of Supply Chain Emission Factors         0
Supply Chain Emission Factors with Margins       0
Reference USEEIO Code                            0
dtype: int64
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="FnyB5AmWXpJ-" data-outputId="3b280f1b-d9d0-4e43-b0fb-9880e2860059">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_CO2 <span class="op">=</span> pd.read_excel(file_path, sheet_name<span class="op">=</span><span class="st">&#39;CO2&#39;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Data shape:&quot;</span>, df_CO2.shape)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">First 5 rows:&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_CO2.head())</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Column names:&quot;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_CO2.columns.tolist())</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Data types:&quot;</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_CO2.dtypes)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Missing values per column:&quot;</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_CO2.isnull().<span class="bu">sum</span>())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Data shape: (1016, 8)

First 5 rows:
   2017 NAICS Code                  2017 NAICS Title       GHG  \
0           111110                   Soybean Farming  All GHGs   
1           111120  Oilseed (except Soybean) Farming  All GHGs   
2           111130          Dry Pea and Bean Farming  All GHGs   
3           111140                     Wheat Farming  All GHGs   
4           111150                      Corn Farming  All GHGs   

                                Unit  \
0  kg CO2e/2022 USD, purchaser price   
1  kg CO2e/2022 USD, purchaser price   
2  kg CO2e/2022 USD, purchaser price   
3  kg CO2e/2022 USD, purchaser price   
4  kg CO2e/2022 USD, purchaser price   

   Supply Chain Emission Factors without Margins  \
0                                          0.488   
1                                          0.488   
2                                          0.809   
3                                          0.809   
4                                          0.809   

   Margins of Supply Chain Emission Factors  \
0                                     0.044   
1                                     0.044   
2                                     0.040   
3                                     0.040   
4                                     0.040   

   Supply Chain Emission Factors with Margins Reference USEEIO Code  
0                                       0.532                1111A0  
1                                       0.532                1111A0  
2                                       0.848                1111B0  
3                                       0.848                1111B0  
4                                       0.848                1111B0  

Column names:
[&#39;2017 NAICS Code&#39;, &#39;2017 NAICS Title&#39;, &#39;GHG&#39;, &#39;Unit&#39;, &#39;Supply Chain Emission Factors without Margins&#39;, &#39;Margins of Supply Chain Emission Factors&#39;, &#39;Supply Chain Emission Factors with Margins&#39;, &#39;Reference USEEIO Code&#39;]

Data types:
2017 NAICS Code                                    int64
2017 NAICS Title                                  object
GHG                                               object
Unit                                              object
Supply Chain Emission Factors without Margins    float64
Margins of Supply Chain Emission Factors         float64
Supply Chain Emission Factors with Margins       float64
Reference USEEIO Code                             object
dtype: object

Missing values per column:
2017 NAICS Code                                  0
2017 NAICS Title                                 0
GHG                                              0
Unit                                             0
Supply Chain Emission Factors without Margins    0
Margins of Supply Chain Emission Factors         0
Supply Chain Emission Factors with Margins       0
Reference USEEIO Code                            0
dtype: int64
</code></pre>
</div>
</div>
<div class="cell code" id="c4eFyzlWX1aw">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Margins of Supply Chain Emission Factors&#39;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Supply Chain Emission Factors with Margins&#39;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> num_cols:</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    df_GHG[col] <span class="op">=</span> pd.to_numeric(df_GHG[col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" id="JOpU3tCRX-4n">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract sector from NAICS code</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_GHG[<span class="st">&#39;NAICS_Sector&#39;</span>] <span class="op">=</span> df_GHG[<span class="st">&#39;2017 NAICS Code&#39;</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>[:<span class="dv">2</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sector_names <span class="op">=</span> {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;11&#39;</span>: <span class="st">&#39;Agriculture, Forestry, Fishing&#39;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;21&#39;</span>: <span class="st">&#39;Mining&#39;</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;22&#39;</span>: <span class="st">&#39;Utilities&#39;</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;23&#39;</span>: <span class="st">&#39;Construction&#39;</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;31&#39;</span>: <span class="st">&#39;Manufacturing&#39;</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;32&#39;</span>: <span class="st">&#39;Manufacturing&#39;</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;33&#39;</span>: <span class="st">&#39;Manufacturing&#39;</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;42&#39;</span>: <span class="st">&#39;Wholesale Trade&#39;</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;44&#39;</span>: <span class="st">&#39;Retail Trade&#39;</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;45&#39;</span>: <span class="st">&#39;Retail Trade&#39;</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;48&#39;</span>: <span class="st">&#39;Transportation&#39;</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;49&#39;</span>: <span class="st">&#39;Transportation&#39;</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;51&#39;</span>: <span class="st">&#39;Information&#39;</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;52&#39;</span>: <span class="st">&#39;Finance&#39;</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;53&#39;</span>: <span class="st">&#39;Real Estate&#39;</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;54&#39;</span>: <span class="st">&#39;Professional Services&#39;</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;55&#39;</span>: <span class="st">&#39;Management&#39;</span>,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;56&#39;</span>: <span class="st">&#39;Administrative&#39;</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;61&#39;</span>: <span class="st">&#39;Educational&#39;</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;62&#39;</span>: <span class="st">&#39;Health Care&#39;</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;71&#39;</span>: <span class="st">&#39;Arts&#39;</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;72&#39;</span>: <span class="st">&#39;Accommodation&#39;</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;81&#39;</span>: <span class="st">&#39;Other Services&#39;</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;92&#39;</span>: <span class="st">&#39;Public Administration&#39;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>df_GHG[<span class="st">&#39;Sector&#39;</span>] <span class="op">=</span> df_GHG[<span class="st">&#39;NAICS_Sector&#39;</span>].<span class="bu">map</span>(sector_names).fillna(<span class="st">&#39;Other&#39;</span>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Define GHG categories</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_ghg(ghg):</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    ghg_low <span class="op">=</span> ghg.lower()</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;carbon dioxide&#39;</span> <span class="kw">in</span> ghg_low <span class="kw">or</span> <span class="st">&#39;co2&#39;</span> <span class="kw">in</span> ghg_low:</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;CO₂&#39;</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&#39;methane&#39;</span> <span class="kw">in</span> ghg_low:</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;CH₄&#39;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&#39;nitrous&#39;</span> <span class="kw">in</span> ghg_low:</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;N₂O&#39;</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&#39;hfc&#39;</span> <span class="kw">in</span> ghg_low:</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;HFCs&#39;</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&#39;pfc&#39;</span> <span class="kw">in</span> ghg_low <span class="kw">or</span> <span class="st">&#39;perfluoro&#39;</span> <span class="kw">in</span> ghg_low:</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;PFCs&#39;</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&#39;sulfur hexafluoride&#39;</span> <span class="kw">in</span> ghg_low:</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;SF₆&#39;</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&#39;nitrogen trifluoride&#39;</span> <span class="kw">in</span> ghg_low:</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;NF₃&#39;</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Other&#39;</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>df_GHG[<span class="st">&#39;GHG_Category&#39;</span>] <span class="op">=</span> df_GHG[<span class="st">&#39;GHG&#39;</span>].<span class="bu">apply</span>(categorize_ghg)</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="JtqFwx_TYTZd" data-outputId="26b38182-c272-4a81-f183-133c30472671">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Unit counts:</span><span class="ch">\n</span><span class="st">&quot;</span>, df_GHG[<span class="st">&#39;Unit&#39;</span>].value_counts())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Unit counts:
 Unit
kg/2022 USD, purchaser price         17272
kg CO2e/2022 USD, purchaser price     1016
Name: count, dtype: int64
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="QKEdfVRCYYYK" data-outputId="253b7676-6d38-42dd-f64c-13ce72e6aa05">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_GHG[num_cols].describe())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>       Supply Chain Emission Factors without Margins  \
count                                   1.828800e+04   
mean                                    1.022439e-02   
std                                     6.376527e-02   
min                                     1.970000e-11   
25%                                     1.330000e-09   
50%                                     1.420000e-08   
75%                                     3.387500e-07   
max                                     3.790000e+00   

       Margins of Supply Chain Emission Factors  \
count                              1.828800e+04   
mean                               8.167654e-04   
std                                5.772884e-03   
min                                0.000000e+00   
25%                                0.000000e+00   
50%                                0.000000e+00   
75%                                1.610000e-09   
max                                1.090000e-01   

       Supply Chain Emission Factors with Margins  
count                                1.828800e+04  
mean                                 1.104055e-02  
std                                  6.669205e-02  
min                                  1.970000e-11  
25%                                  1.580000e-09  
50%                                  1.650000e-08  
75%                                  3.500000e-07  
max                                  3.860000e+00  
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="M2GSx9N7Yd3q" data-outputId="a9a93e8e-9eb0-471a-a508-c3d023faff83">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plt.hist(np.log10(df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>] <span class="op">+</span> <span class="fl">1e-15</span>), bins<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;log10( Emission Factor (kg/$) )&#39;</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Base Emission Factors (log scale)&#39;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df_GHG, x<span class="op">=</span><span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>, y<span class="op">=</span><span class="st">&#39;GHG_Category&#39;</span>, orient<span class="op">=</span><span class="st">&#39;h&#39;</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Emission Factor (kg/$)&#39;</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Emission Factors by GHG Category&#39;</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df_GHG, x<span class="op">=</span><span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>, y<span class="op">=</span><span class="st">&#39;Sector&#39;</span>, orient<span class="op">=</span><span class="st">&#39;h&#39;</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Emission Factor (kg/$)&#39;</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Emission Factors by Sector&#39;</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>plt.scatter(df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>],</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>            df_GHG[<span class="st">&#39;Margins of Supply Chain Emission Factors&#39;</span>],</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>            alpha<span class="op">=</span><span class="fl">0.3</span>, s<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Base Emission Factor (kg/$)&#39;</span>)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Margin (kg/$)&#39;</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Base vs Margins&#39;</span>)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="fl">1e-11</span>, <span class="fl">1e-1</span>], [<span class="fl">1e-11</span>, <span class="fl">1e-1</span>], <span class="st">&#39;r--&#39;</span>, label<span class="op">=</span><span class="st">&#39;Margin = Base&#39;</span>)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>df_GHG[<span class="st">&#39;Margin_Ratio&#39;</span>] <span class="op">=</span> df_GHG[<span class="st">&#39;Margins of Supply Chain Emission Factors&#39;</span>] <span class="op">/</span> df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>]</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>plt.hist(df_GHG[<span class="st">&#39;Margin_Ratio&#39;</span>], bins<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>, log<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Margin / Base Ratio&#39;</span>)</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency (log)&#39;</span>)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Margin-to-Base Ratio&#39;</span>)</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>plt.axvline(<span class="dv">1</span>, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, label<span class="op">=</span><span class="st">&#39;Margin = Base&#39;</span>)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>Q1 <span class="op">=</span> df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>].quantile(<span class="fl">0.25</span>)</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>Q3 <span class="op">=</span> df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>lower <span class="op">=</span> Q1 <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> Q3 <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> df_GHG[(df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>] <span class="op">&lt;</span> lower) <span class="op">|</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>              (df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>] <span class="op">&gt;</span> upper)]</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Number of outliers: </span><span class="sc">{</span><span class="bu">len</span>(outliers)<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(outliers)<span class="op">/</span><span class="bu">len</span>(df_GHG)<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)&quot;</span>)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(outliers[[<span class="st">&#39;2017 NAICS Title&#39;</span>, <span class="st">&#39;GHG&#39;</span>, <span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>]].head(<span class="dv">10</span>))</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/a4710f9b5e9840eac35c0716af463d3e69b46327.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/12f67278ddc0d1127e0c78a429a86dcfc0ef1b02.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/11d28f6771f3310b5b884fbca7f7f589e13f9e22.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/ae64dc92805168d24193899c0451f910f72124c3.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/666d8b4d70ff7346f9959158ebf3b5ebc9d5e523.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Number of outliers: 4200 (22.97%)
                    2017 NAICS Title                         GHG  \
1                    Soybean Farming              Carbon dioxide   
6                    Soybean Farming  HFCs and PFCs, unspecified   
8                    Soybean Farming                     Methane   
12                   Soybean Farming               Nitrous oxide   
18  Oilseed (except Soybean) Farming              Carbon dioxide   
24  Oilseed (except Soybean) Farming               Nitrous oxide   
31  Oilseed (except Soybean) Farming  HFCs and PFCs, unspecified   
33  Oilseed (except Soybean) Farming                     Methane   
41          Dry Pea and Bean Farming              Carbon dioxide   
42          Dry Pea and Bean Farming  HFCs and PFCs, unspecified   

    Supply Chain Emission Factors without Margins  
1                                        0.134000  
6                                        0.000358  
8                                        0.000331  
12                                       0.001300  
18                                       0.134000  
24                                       0.001300  
31                                       0.000358  
33                                       0.000331  
41                                       0.173000  
42                                       0.000384  
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="BlAtnkXaeS_z" data-outputId="19b86164-6945-4689-85f8-7c9f1ade5e4f">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sector_avg <span class="op">=</span> df_GHG.groupby(<span class="st">&#39;Sector&#39;</span>)[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sector_avg)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Sector
Transportation                    0.024392
Utilities                         0.014273
Manufacturing                     0.014251
Mining                            0.013513
Construction                      0.011100
Agriculture, Forestry, Fishing    0.008675
Administrative                    0.007792
Real Estate                       0.006845
Accommodation                     0.006398
Retail Trade                      0.005988
Arts                              0.005924
Wholesale Trade                   0.005562
Health Care                       0.005518
Educational                       0.005365
Other Services                    0.004969
Professional Services             0.004226
Management                        0.004044
Finance                           0.003763
Information                       0.002812
Name: Supply Chain Emission Factors without Margins, dtype: float64
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="o_PUDHdCeZgq" data-outputId="a3cf9e7f-156c-4a95-8838-00c23ec1bbca">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>cat_sum <span class="op">=</span> df_GHG.groupby(<span class="st">&#39;GHG_Category&#39;</span>)[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plt.pie(cat_sum, labels<span class="op">=</span>cat_sum.index, autopct<span class="op">=</span><span class="st">&#39;</span><span class="sc">%1.1f%%</span><span class="st">&#39;</span>, startangle<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Total Emission Factor Contribution by GHG Category&#39;</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>pivot <span class="op">=</span> pd.pivot_table(df_GHG,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                       values<span class="op">=</span><span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                       index<span class="op">=</span><span class="st">&#39;Sector&#39;</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                       columns<span class="op">=</span><span class="st">&#39;GHG_Category&#39;</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                       aggfunc<span class="op">=</span><span class="st">&#39;mean&#39;</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                       fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pivot)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df_GHG[num_cols].corr()</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>, center<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Correlation Matrix&#39;</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>top_naics <span class="op">=</span> df_GHG.groupby([<span class="st">&#39;2017 NAICS Code&#39;</span>, <span class="st">&#39;2017 NAICS Title&#39;</span>])[<span class="st">&#39;Supply Chain Emission Factors with Margins&#39;</span>].<span class="bu">sum</span>().nlargest(<span class="dv">10</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Top 10 NAICS by total emission factor (with margins):&quot;</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_naics)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/65804fe166bf3fc57d7c41afd046814f0978ef30.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>GHG_Category                         CH₄       CO₂      HFCs           NF₃  \
Sector                                                                       
Accommodation                   0.000758  0.112693  0.000237  7.753333e-10   
Administrative                  0.006653  0.128445  0.000733  3.026455e-09   
Agriculture, Forestry, Fishing  0.007970  0.146566  0.000058  1.019547e-09   
Arts                            0.000704  0.104688  0.000170  8.589200e-10   
Construction                    0.000638  0.195290  0.000550  1.214968e-09   
Educational                     0.000528  0.094988  0.000149  1.142353e-09   
Finance                         0.000283  0.066868  0.000082  4.468293e-10   
Health Care                     0.000679  0.096536  0.000293  1.425769e-09   
Information                     0.000171  0.048216  0.000318  1.252581e-09   
Management                      0.000289  0.071700  0.000114  1.650000e-09   
Manufacturing                   0.000999  0.254311  0.000156  7.314426e-09   
Mining                          0.003970  0.238679  0.000078  7.403929e-10   
Other Services                  0.000347  0.086969  0.000301  3.444458e-09   
Professional Services           0.000296  0.074290  0.000209  1.961531e-09   
Real Estate                     0.000617  0.120817  0.000252  1.448667e-09   
Retail Trade                    0.000361  0.106152  0.000180  9.138182e-10   
Transportation                  0.002427  0.430053  0.000937  8.417544e-10   
Utilities                       0.006788  0.248500  0.000166  9.427500e-10   
Wholesale Trade                 0.000425  0.097725  0.000276  3.076761e-09   

GHG_Category                         N₂O         Other          PFCs  \
Sector                                                                 
Accommodation                   0.000051  5.815000e-09  8.751000e-10   
Administrative                  0.000030  1.538086e-08  4.402493e-09   
Agriculture, Forestry, Fishing  0.001199  4.498578e-09  1.378092e-09   
Arts                            0.000047  5.648760e-09  8.976360e-10   
Construction                    0.000020  1.540855e-08  8.945081e-10   
Educational                     0.000017  7.059941e-09  9.921029e-10   
Finance                         0.000007  2.586915e-09  4.652195e-10   
Health Care                     0.000051  8.090013e-09  1.176210e-09   
Information                     0.000007  7.770145e-09  6.273266e-10   
Management                      0.000009  6.690000e-09  2.521000e-09   
Manufacturing                   0.000111  9.078357e-08  8.275663e-09   
Mining                          0.000034  6.222107e-09  6.861000e-10   
Other Services                  0.000013  1.746967e-08  2.206605e-09   
Professional Services           0.000016  1.186242e-08  1.365032e-09   
Real Estate                     0.000018  7.226021e-09  1.835949e-09   
Retail Trade                    0.000017  5.532106e-09  9.012939e-10   
Transportation                  0.000029  6.834675e-09  7.465285e-10   
Utilities                       0.000470  8.878375e-09  8.931375e-10   
Wholesale Trade                 0.000025  1.534658e-08  2.534765e-09   

GHG_Category                             SF₆  
Sector                                        
Accommodation                   9.980000e-09  
Administrative                  7.804091e-09  
Agriculture, Forestry, Fishing  4.016406e-09  
Arts                            9.032800e-09  
Construction                    1.286387e-08  
Educational                     6.232941e-09  
Finance                         3.202683e-09  
Health Care                     7.592821e-09  
Information                     4.738387e-09  
Management                      7.370000e-09  
Manufacturing                   2.744958e-08  
Mining                          1.327000e-08  
Other Services                  9.988125e-09  
Professional Services           7.710816e-09  
Real Estate                     9.937083e-09  
Retail Trade                    1.117470e-08  
Transportation                  8.173158e-09  
Utilities                       2.092500e-08  
Wholesale Trade                 8.942958e-09  
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/514597263edb55ba218cd792ddeaa654732ae9f9.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Top 10 NAICS by total emission factor (with margins):
2017 NAICS Code  2017 NAICS Title                                     
327310           Cement Manufacturing                                     3.863366
327410           Lime Manufacturing                                       1.552849
327420           Gypsum Product Manufacturing                             1.552849
486110           Pipeline Transportation of Crude Oil                     1.080152
486210           Pipeline Transportation of Natural Gas                   1.080152
486910           Pipeline Transportation of Refined Petroleum Products    1.080152
486990           All Other Pipeline Transportation                        1.080152
325120           Industrial Gas Manufacturing                             1.062466
324121           Asphalt Paving Mixture and Block Manufacturing           1.033959
325193           Ethyl Alcohol Manufacturing                              0.969270
Name: Supply Chain Emission Factors with Margins, dtype: float64
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="Pypm_Etie7m-" data-outputId="5602c29d-408d-43c9-8d91-77a4d6e1a486">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>zero_margins <span class="op">=</span> df_GHG[df_GHG[<span class="st">&#39;Margins of Supply Chain Emission Factors&#39;</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Rows with zero margins: </span><span class="sc">{</span><span class="bu">len</span>(zero_margins)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(zero_margins[<span class="st">&#39;2017 NAICS Title&#39;</span>].value_counts().head())</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>inconsistent <span class="op">=</span> df_GHG.groupby(<span class="st">&#39;GHG&#39;</span>)[<span class="st">&#39;Unit&#39;</span>].nunique()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inconsistent[inconsistent <span class="op">&gt;</span> <span class="dv">1</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Rows with zero margins: 10116
2017 NAICS Title
Other Similar Organizations (except Business, Professional, Labor, and Political Organizations)    18
Cotton Ginning                                                                                     18
Photofinishing Laboratories (except One-Hour)                                                      18
Pet Care (except Veterinary) Services                                                              18
Industrial Launderers                                                                              18
Name: count, dtype: int64
Series([], Name: Unit, dtype: int64)
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="SsZodcx9eZaD" data-outputId="12b77e4d-764f-40b8-837b-0c820d120ced">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;EXPLORATORY DATA ANALYSIS SUMMARY&quot;</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Dataset shape: </span><span class="sc">{</span>df_GHG<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Missing values: </span><span class="sc">{</span>df_GHG<span class="sc">.</span>isnull()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Unique GHGs: </span><span class="sc">{</span>df_GHG[<span class="st">&#39;GHG&#39;</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Unique NAICS industries: </span><span class="sc">{</span>df_GHG[<span class="st">&#39;2017 NAICS Code&#39;</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Range of base emission factors: </span><span class="sc">{</span>df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.2e}</span><span class="ss"> to </span><span class="sc">{</span>df_GHG[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2e}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Median margin ratio: </span><span class="sc">{</span>df_GHG[<span class="st">&#39;Margin_Ratio&#39;</span>]<span class="sc">.</span>median()<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Top sector by average emission factor: </span><span class="sc">{</span>sector_avg<span class="sc">.</span>index[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Top GHG category by total: </span><span class="sc">{</span>cat_sum<span class="sc">.</span>index[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Outliers detected: </span><span class="sc">{</span><span class="bu">len</span>(outliers)<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(outliers)<span class="op">/</span><span class="bu">len</span>(df_GHG)<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)&quot;</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>============================================================
EXPLORATORY DATA ANALYSIS SUMMARY
============================================================
Dataset shape: (18288, 12)
Missing values: 0
Unique GHGs: 18
Unique NAICS industries: 1016
Range of base emission factors: 1.97e-11 to 3.79e+00
Median margin ratio: 0.000
Top sector by average emission factor: Transportation
Top GHG category by total: CO₂
Outliers detected: 4200 (23.0%)
============================================================
</code></pre>
</div>
</div>
<div class="cell markdown" id="nnN5-6ITswRX">
<p>The dataset contains 8 columns detailing supply chain greenhouse gas
(GHG) emission factors for various U.S. industries categorized by NAICS
codes. Each row represents a unique combination of:</p>
<ul>
<li>Industry (NAICS Code &amp; Title)</li>
<li>GHG type (e.g., CO₂, CH₄, N₂O, HFCs, PFCs, SF₆, NF₃)</li>
<li>Emission factor values (with/without margins)</li>
<li>Reference code (USEEIO model)</li>
</ul>
<p>Columns:</p>
<ol>
<li>2017 NAICS Code – Industry classification code</li>
<li>2017 NAICS Title – Industry description</li>
<li>GHG – Greenhouse gas name</li>
<li>Unit – Units (kg or kg CO₂e per 2022 USD purchaser price)</li>
<li>Supply Chain Emission Factors without Margins – Base emission
factor</li>
<li>Margins of Supply Chain Emission Factors – Margin/uncertainty
component</li>
<li>Supply Chain Emission Factors with Margins – Total emission
factor</li>
<li>Reference USEEIO Code – Model reference code</li>
</ol>
<p>Data Cleaning &amp; Quality Assessment</p>
<p>Missing Values:</p>
<ul>
<li>No missing values detected in any column.</li>
<li>All rows are fully populated.</li>
</ul>
<p>Data Types:</p>
<ul>
<li>Categorical: NAICS Code, NAICS Title, GHG, Unit, Reference USEEIO
Code</li>
<li>Numerical: Emission factor columns (scientific notation for small
values)</li>
</ul>
<p>Consistency Checks:</p>
<ul>
<li>Units: Most GHGs use kg/2022 USD, purchaser price except:
<ul>
<li>HFCs and PFCs, unspecified uses kg CO2e/2022 USD, purchaser price
(CO₂-equivalent unit)</li>
</ul></li>
<li>NAICS Codes: Valid 6-digit codes ranging from 111110 (Soybean
Farming) to 211130 (Natural Gas Extraction)</li>
<li>Reference Codes: Consistent with NAICS groupings (e.g., 1111A0 for
oilseed farming, 1121A0 for cattle)</li>
</ul>
<p>Duplicates:</p>
<ul>
<li>No exact duplicate rows found.</li>
<li>Multiple entries per NAICS code (one per GHG type).</li>
</ul>
<p>Summary Statistics (Numerical Columns)</p>
<p>Emission Factor Ranges:</p>
<p>Column Min Max Mean Notes</p>
<p>Column Min Max Mean Notes Without Margins 5.47e-11 0.0581 ~0.05*
Highly skewed Margins 0 (in 115xxx) 0.000655 ~0.0001* Often &lt;1% of
base With Margins 6.36e-10 0.0582 ~0.05* Slightly &gt; base</p>
<p>*Mean approximated due to wide range.</p>
<p>Key Observations:</p>
<ul>
<li>Carbon dioxide (CO₂) has the largest absolute values (up to 0.293
kg/$).</li>
<li>HFCs, PFCs, SF₆, NF₃ have extremely small factors (10⁻⁸ to
10⁻¹¹).</li>
<li>Margins are generally small—often negligible compared to base
values.</li>
<li>Zero margins in NAICS 115xxx (Support Activities for
Agriculture).</li>
</ul>
<p>Distribution Analysis</p>
<p>GHG Types (Categorical):</p>
<ul>
<li>Most common GHGs: CO₂, CH₄, N₂O, and multiple HFC/PFC variants.</li>
<li>Special category: HFCs and PFCs, unspecified (CO₂e aggregated).</li>
</ul>
<p>NAICS Sectors:</p>
<ul>
<li>111xxx: Crop production (soybeans, grains, vegetables, fruits)</li>
<li>112xxx: Animal production (cattle, poultry, aquaculture)</li>
<li>113xxx: Forestry</li>
<li>114xxx: Fishing &amp; hunting</li>
<li>115xxx: Agriculture/forestry support activities</li>
<li>211xxx: Oil &amp; gas extraction</li>
</ul>
<p>Emission Factor Distributions:</p>
<ul>
<li>Right-skewed: Most values are small (&lt;0.01), few are large
(&gt;0.1).</li>
<li>Log-scale visualization recommended due to orders-of-magnitude
differences.</li>
</ul>
<p>Relationships &amp; Trends</p>
<p>Base vs. Margins:</p>
<ul>
<li>Margins are proportional to base values in most sectors.</li>
<li>Exceptions: Some HFCs have margins larger than base values (e.g.,
HFC-32 in 111110).</li>
</ul>
<p>Sector-Level Insights:</p>
<ul>
<li>Animal Production (112xxx) – Highest methane (CH₄) emissions:
<ul>
<li>Beef cattle: 0.0581 kg/$ (highest single value)</li>
<li>Dairy: 0.0405 kg/$</li>
</ul></li>
<li>Crop Production (111xxx) – Dominated by CO₂ and N₂O:
<ul>
<li>Rice farming: high methane (0.00384 kg/$)</li>
<li>Grain farming: high N₂O (~0.00199 kg/$)</li>
</ul></li>
<li>Oil &amp; Gas (211xxx) – Significant methane (0.0077 kg/$) and
CO₂.</li>
</ul>
<p>GHG Contribution by Sector:</p>
<ul>
<li>CO₂: Highest in crop production and support activities.</li>
<li>CH₄: Dominates animal production and rice farming.</li>
<li>N₂O: Significant in fertilizer-intensive crops (grains,
vegetables).</li>
<li>F-gases (HFCs/PFCs): Present across all sectors but in trace
amounts.</li>
</ul>
<p>Outlier Detection</p>
<p>High-Value Outliers:</p>
<ul>
<li>Methane in beef cattle (0.0581) – 10–100× higher than other
sectors.</li>
<li>CO₂ in dairy (0.257) – highest CO₂ value.</li>
<li>N₂O in beef cattle (0.00385) – highest N₂O.</li>
</ul>
<p>Low-Value Consistency:</p>
<ul>
<li>F-gases consistently in 10⁻⁸ to 10⁻¹¹ range—no anomalous zeros or
spikes.</li>
</ul>
<p>Margin Outliers:</p>
<ul>
<li>Zero margins in NAICS 115xxx (support activities)—data quality
flag.</li>
</ul>
<p>Visual Insights (Hypothetical Charts)</p>
<ul>
<li>Heatmap: GHG × NAICS sector → shows methane hotspots in animal
production.<br />
</li>
<li>Bar chart: Top 10 NAICS by total CO₂e (using “with margins”).</li>
<li>Scatter plot: Base vs. margins colored by GHG type.</li>
<li>Box plots: Emission factor distributions by sector (log scale).</li>
</ul>
<p>Key Findings</p>
<ol>
<li>Sectoral Hotspots:</li>
</ol>
<ul>
<li>Animal agriculture is the largest CH₄ source.</li>
<li>Grain/row crops dominate N₂O emissions.</li>
<li>Support activities have high CO₂ but zero margins (possible data
gap).</li>
</ul>
<ol>
<li>GHG Profile:</li>
</ol>
<ul>
<li>CO₂ and CH₄ account for &gt;90% of mass-based emissions.</li>
<li>F-gases are negligible in mass but high in global warming potential
(GWP).</li>
</ul>
<ol>
<li>Data Quality:</li>
</ol>
<ul>
<li>High consistency within NAICS groupings.<br />
</li>
<li>Margins are small except for some F-gases.</li>
<li>Unit inconsistency for “HFCs/PFCs unspecified” (CO₂e vs. mass).</li>
</ul>
<ol>
<li>Modeling Implications:</li>
</ol>
<ul>
<li>USEEIO codes group NAICS sectors for input-output modeling.<br />
</li>
<li>Margins may represent uncertainty or upstream/downstream
effects.</li>
</ul>
<p>Recommendations for Further Analysis</p>
<ul>
<li>Convert all units to CO₂e using GWPs for consistent comparison.</li>
<li>Aggregate by NAICS sector to rank industries by total climate
impact.</li>
<li>Investigate zero margins in support activities (115xxx).</li>
<li>Time-series analysis if historical data exists.<br />
</li>
<li>Benchmarking against direct emission factors (if available).</li>
</ul>
</div>
<div class="cell code" id="JPNwV4S6nptZ">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set visualization style</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&#39;whitegrid&#39;</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">&#39;figure.figsize&#39;</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">6</span>)</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:74}"
id="xpznts7rd0zx" data-outputId="4aafb28e-5e8e-4446-f799-06c7b00cb5e6">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> files</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>uploaded <span class="op">=</span> files.upload()</span></code></pre></div>
<div class="output display_data">

     <input type="file" id="files-0539c14b-81fe-4c3f-9784-fe9f224e4fe5" name="files[]" multiple disabled
        style="border:none" />
     <output id="result-0539c14b-81fe-4c3f-9784-fe9f224e4fe5">
      Upload widget is only available when the cell has been executed in the
      current browser session. Please rerun this cell to enable.
      </output>
      <script>// Copyright 2017 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Helpers for google.colab Python module.
 */
(function(scope) {
function span(text, styleAttributes = {}) {
  const element = document.createElement('span');
  element.textContent = text;
  for (const key of Object.keys(styleAttributes)) {
    element.style[key] = styleAttributes[key];
  }
  return element;
}

// Max number of bytes which will be uploaded at a time.
const MAX_PAYLOAD_SIZE = 100 * 1024;

function _uploadFiles(inputId, outputId) {
  const steps = uploadFilesStep(inputId, outputId);
  const outputElement = document.getElementById(outputId);
  // Cache steps on the outputElement to make it available for the next call
  // to uploadFilesContinue from Python.
  outputElement.steps = steps;

  return _uploadFilesContinue(outputId);
}

// This is roughly an async generator (not supported in the browser yet),
// where there are multiple asynchronous steps and the Python side is going
// to poll for completion of each step.
// This uses a Promise to block the python side on completion of each step,
// then passes the result of the previous step as the input to the next step.
function _uploadFilesContinue(outputId) {
  const outputElement = document.getElementById(outputId);
  const steps = outputElement.steps;

  const next = steps.next(outputElement.lastPromiseValue);
  return Promise.resolve(next.value.promise).then((value) => {
    // Cache the last promise value to make it available to the next
    // step of the generator.
    outputElement.lastPromiseValue = value;
    return next.value.response;
  });
}

/**
 * Generator function which is called between each async step of the upload
 * process.
 * @param {string} inputId Element ID of the input file picker element.
 * @param {string} outputId Element ID of the output display.
 * @return {!Iterable<!Object>} Iterable of next steps.
 */
function* uploadFilesStep(inputId, outputId) {
  const inputElement = document.getElementById(inputId);
  inputElement.disabled = false;

  const outputElement = document.getElementById(outputId);
  outputElement.innerHTML = '';

  const pickedPromise = new Promise((resolve) => {
    inputElement.addEventListener('change', (e) => {
      resolve(e.target.files);
    });
  });

  const cancel = document.createElement('button');
  inputElement.parentElement.appendChild(cancel);
  cancel.textContent = 'Cancel upload';
  const cancelPromise = new Promise((resolve) => {
    cancel.onclick = () => {
      resolve(null);
    };
  });

  // Wait for the user to pick the files.
  const files = yield {
    promise: Promise.race([pickedPromise, cancelPromise]),
    response: {
      action: 'starting',
    }
  };

  cancel.remove();

  // Disable the input element since further picks are not allowed.
  inputElement.disabled = true;

  if (!files) {
    return {
      response: {
        action: 'complete',
      }
    };
  }

  for (const file of files) {
    const li = document.createElement('li');
    li.append(span(file.name, {fontWeight: 'bold'}));
    li.append(span(
        `(${file.type || 'n/a'}) - ${file.size} bytes, ` +
        `last modified: ${
            file.lastModifiedDate ? file.lastModifiedDate.toLocaleDateString() :
                                    'n/a'} - `));
    const percent = span('0% done');
    li.appendChild(percent);

    outputElement.appendChild(li);

    const fileDataPromise = new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        resolve(e.target.result);
      };
      reader.readAsArrayBuffer(file);
    });
    // Wait for the data to be ready.
    let fileData = yield {
      promise: fileDataPromise,
      response: {
        action: 'continue',
      }
    };

    // Use a chunked sending to avoid message size limits. See b/62115660.
    let position = 0;
    do {
      const length = Math.min(fileData.byteLength - position, MAX_PAYLOAD_SIZE);
      const chunk = new Uint8Array(fileData, position, length);
      position += length;

      const base64 = btoa(String.fromCharCode.apply(null, chunk));
      yield {
        response: {
          action: 'append',
          file: file.name,
          data: base64,
        },
      };

      let percentDone = fileData.byteLength === 0 ?
          100 :
          Math.round((position / fileData.byteLength) * 100);
      percent.textContent = `${percentDone}% done`;

    } while (position < fileData.byteLength);
  }

  // All done.
  yield {
    response: {
      action: 'complete',
    }
  };
}

scope.google = scope.google || {};
scope.google.colab = scope.google.colab || {};
scope.google.colab._files = {
  _uploadFiles,
  _uploadFilesContinue,
};
})(self);
</script> 
</div>
<div class="output stream stdout">
<pre><code>Saving emission-factor-hub.xlsx to emission-factor-hub.xlsx
</code></pre>
</div>
</div>
<div class="cell code" id="JoCIQS6BN47S">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="bu">list</span>(uploaded.keys())[<span class="dv">0</span>]</span></code></pre></div>
</div>
<div class="cell code" id="TFQawGibbJHO">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>xls <span class="op">=</span> pd.ExcelFile(file_path)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="op">=</span> xls.sheet_names</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="fEeHGKrx0MDZ" data-outputId="859d026e-af6d-44f7-cba6-4df8bbe69114">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Total sheets: </span><span class="sc">{</span><span class="bu">len</span>(sheet_names)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Sheet names:&quot;</span>, sheet_names)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Dictionary to hold dataframes for each sheet</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> {}</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to clean column names (strip, lowercase, replace spaces)</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_cols(df):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [<span class="bu">str</span>(col).strip().lower().replace(<span class="st">&#39; &#39;</span>, <span class="st">&#39;_&#39;</span>).replace(<span class="st">&#39;(&#39;</span>, <span class="st">&#39;&#39;</span>).replace(<span class="st">&#39;)&#39;</span>, <span class="st">&#39;&#39;</span>).replace(<span class="st">&#39;&lt;br&gt;&#39;</span>, <span class="st">&#39;_&#39;</span>) <span class="cf">for</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Load each sheet with some custom handling</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sheet <span class="kw">in</span> sheet_names:</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">--- Loading sheet: </span><span class="sc">{</span>sheet<span class="sc">}</span><span class="ss"> ---&quot;</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the sheet; header is typically the first row (0)</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span>sheet, header<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean column names</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> clean_cols(df)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store in dictionary</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    dfs[sheet] <span class="op">=</span> df</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Columns: </span><span class="sc">{</span><span class="bu">list</span>(df.columns)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;First 5 rows:&quot;</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.head())</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Missing values per column:&quot;</span>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.isnull().<span class="bu">sum</span>())</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">60</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Total sheets: 13
Sheet names: [&#39;Table 1&#39;, &#39;Table 2&#39;, &#39;Table 3&#39;, &#39;Table 4&#39;, &#39;Table 5&#39;, &#39;Table 6&#39;, &#39;Table 7&#39;, &#39;Table 8&#39;, &#39;Table 9&#39;, &#39;Table 10&#39;, &#39;Table 11&#39;, &#39;Table 12&#39;, &#39;Table 13&#39;]

--- Loading sheet: Table 1 ---
Shape: (76, 8)
Columns: [&#39;table_1&#39;, &#39;stationary_combustion&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;, &#39;unnamed:_5&#39;, &#39;unnamed:_6&#39;, &#39;unnamed:_7&#39;]
First 5 rows:
           table_1 stationary_combustion        unnamed:_2       unnamed:_3  \
0        Fuel Type    Heat Content (HHV)        CO2 Factor       CH4 Factor   
1              NaN   mmBtu per short ton  kg CO2 per mmBtu  g CH4 per mmBtu   
2    Coal and Coke                   NaN               NaN              NaN   
3  Anthracite Coal                 25.09            103.69               11   
4  Bituminous Coal                 24.93             93.28               11   

        unnamed:_4            unnamed:_5           unnamed:_6  \
0       N2O Factor            CO2 Factor           CH4 Factor   
1  g N2O per mmBtu  kg CO2 per short ton  g CH4 per short ton   
2              NaN                   NaN                  NaN   
3              1.6                  2602                  276   
4              1.6                  2325                  274   

            unnamed:_7  
0           N2O Factor  
1  g N2O per short ton  
2                  NaN  
3                   40  
4                   40  

Missing values per column:
table_1                   3
stationary_combustion    14
unnamed:_2                9
unnamed:_3                9
unnamed:_4                9
unnamed:_5               14
unnamed:_6               14
unnamed:_7               14
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 2 ---
Shape: (11, 3)
Columns: [&#39;table_2&#39;, &#39;mobile_combustion_co2&#39;, &#39;unnamed:_2&#39;]
First 5 rows:
                        table_2 mobile_combustion_co2 unnamed:_2
0                     Fuel Type       kg CO2 per unit       Unit
1             Aviation Gasoline                  8.31     gallon
2              Biodiesel (100%)                  9.45     gallon
3  Compressed Natural Gas (CNG)               0.05444        scf
4                   Diesel Fuel                 10.21     gallon

Missing values per column:
table_2                  0
mobile_combustion_co2    0
unnamed:_2               0
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 3 ---
Shape: (445, 5)
Columns: [&#39;table_3&#39;, &#39;mobile_combustion_ch4_and_n2o_for_on-road_gasoline_vehicles&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;]
First 5 rows:
                   table_3  \
0             Vehicle Type   
1  Gasoline Passenger Cars   
2                      NaN   
3                      NaN   
4                      NaN   

  mobile_combustion_ch4_and_n2o_for_on-road_gasoline_vehicles  \
0                                               Year            
1                                        1973-1974              
2                                              1975             
3                                         1976-1977             
4                                         1978-1979             

                unnamed:_2               unnamed:_3 unnamed:_4  
0  CH4 Factor \n(g / mile)  N2O Factor \n(g / mile)       year  
1                   0.1696                   0.0197       2022  
2                   0.1423                   0.0443       2022  
3                   0.1406                   0.0458       2022  
4                   0.1389                   0.0473       2022  

Missing values per column:
table_3                                                        421
mobile_combustion_ch4_and_n2o_for_on-road_gasoline_vehicles      0
unnamed:_2                                                       0
unnamed:_3                                                       0
unnamed:_4                                                       3
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 4 ---
Shape: (140, 6)
Columns: [&#39;table_4&#39;, &#39;mobile_combustion_ch4_and_n2o_for_on-road_diesel_and_alternative_fuel_vehicles&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;, &#39;unnamed:_5&#39;]
First 5 rows:
             table_4  \
0       Vehicle Type   
1     Passenger Cars   
2                NaN   
3                NaN   
4  Light-Duty Trucks   

  mobile_combustion_ch4_and_n2o_for_on-road_diesel_and_alternative_fuel_vehicles  \
0                                          Fuel Type                               
1                                             Diesel                               
2                                                NaN                               
3                                                NaN                               
4                                             Diesel                               

     unnamed:_2               unnamed:_3               unnamed:_4 unnamed:_5  
0  Vehicle Year  CH4 Factor \n(g / mile)  N2O Factor \n(g / mile)       Year  
1     1960-1982                   0.0006                   0.0012       2022  
2     1983-2006                   0.0005                    0.001       2022  
3     2007-2019                   0.0302                   0.0192       2022  
4     1960-1982                   0.0011                   0.0017       2022  

Missing values per column:
table_4                                                                           104
mobile_combustion_ch4_and_n2o_for_on-road_diesel_and_alternative_fuel_vehicles     20
unnamed:_2                                                                        104
unnamed:_3                                                                          0
unnamed:_4                                                                          0
unnamed:_5                                                                          3
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 5 ---
Shape: (164, 5)
Columns: [&#39;table_5&#39;, &#39;mobile_combustion_ch4_and_n2o_for_non-road_vehicles&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;]
First 5 rows:
           table_5 mobile_combustion_ch4_and_n2o_for_non-road_vehicles  \
0     Vehicle Type                                          Fuel Type    
1  Ships and Boats                                  Residual Fuel Oil    
2              NaN                                Gasoline (2 stroke)    
3              NaN                                Gasoline (4 stroke)    
4              NaN                                             Diesel    

                   unnamed:_2                  unnamed:_3 unnamed:_4  
0  CH4 Factor \n(g / gallon)   N2O Factor \n(g / gallon)        Year  
1                        1.11                        0.32       2022  
2                        4.58                        0.08       2022  
3                        2.24                        0.01       2022  
4                        6.41                        0.17       2022  

Missing values per column:
table_5                                                114
mobile_combustion_ch4_and_n2o_for_non-road_vehicles      0
unnamed:_2                                               0
unnamed:_3                                               0
unnamed:_4                                               3
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 6 ---
Shape: (124, 9)
Columns: [&#39;table_6&#39;, &#39;electricity&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;, &#39;unnamed:_5&#39;, &#39;unnamed:_6&#39;, &#39;unnamed:_7&#39;, &#39;unnamed:_8&#39;]
First 5 rows:
                     table_6                    electricity  unnamed:_2  \
0                        NaN  Total Output Emission Factors         NaN   
1            eGRID Subregion                     CO2 Factor  CH4 Factor   
2                        NaN                     (lb / MWh)  (lb / MWh)   
3    AKGD (ASCC Alaska Grid)                         1097.6         0.1   
4  AKMS (ASCC Miscellaneous)                          534.1       0.027   

   unnamed:_3                     unnamed:_4  unnamed:_5  unnamed:_6  \
0         NaN  Non-Baseload Emission Factors         NaN         NaN   
1  N2O Factor                     CO2 Factor  CH4 Factor  N2O Factor   
2  (lb / MWh)                     (lb / MWh)  (lb / MWh)  (lb / MWh)   
3       0.014                         1315.1       0.126       0.017   
4       0.005                         1517.7       0.066       0.012   

  unnamed:_7 unnamed:_8  
0       Year        NaN  
1        NaN        NaN  
2        NaN        NaN  
3       2022        NaN  
4       2022        NaN  

Missing values per column:
table_6         8
electricity     0
unnamed:_2      4
unnamed:_3      4
unnamed:_4      0
unnamed:_5      4
unnamed:_6      4
unnamed:_7      5
unnamed:_8     96
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 7 ---
Shape: (2, 4)
Columns: [&#39;table_7&#39;, &#39;steam_and_heat&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;]
First 5 rows:
          table_7             steam_and_heat                 unnamed:_2  \
0             NaN  CO2 Factor \n(kg / mmBtu)  CH4 Factor \n(g / mmBtu)    
1  Steam and Heat                      66.33                       1.25   

                  unnamed:_3  
0  N2O Factor \n(g / mmBtu)   
1                      0.125  

Missing values per column:
table_7           1
steam_and_heat    0
unnamed:_2        0
unnamed:_3        0
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 8 ---
Shape: (32, 6)
Columns: [&#39;table_8&#39;, &#39;scope_3_category_4:_upstream_transportation_and_distribution_and_category_9:_downstream_transportation_and_distribution&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;, &#39;unnamed:_5&#39;]
First 5 rows:
                        table_8  \
0                  Vehicle Type   
1  Medium- and Heavy-Duty Truck   
2               Passenger Car A   
3            Light-Duty Truck B   
4  Medium- and Heavy-Duty Truck   

  scope_3_category_4:_upstream_transportation_and_distribution_and_category_9:_downstream_transportation_and_distribution  \
0                           CO2 Factor \n(kg / unit)                                                                        
1                                               1.45                                                                        
2                                              0.332                                                                        
3                                              0.454                                                                        
4                                              0.211                                                                        

                unnamed:_2               unnamed:_3    unnamed:_4 unnamed:_5  
0  CH4 Factor \n(g / unit)  N2O Factor \n(g / unit)         Units       Year  
1                    0.013                    0.034  vehicle-mile       2022  
2                    0.007                    0.007  vehicle-mile       2022  
3                    0.012                    0.009  vehicle-mile       2022  
4                    0.002                   0.0049      ton-mile       2022  

Missing values per column:
table_8                                                                                                                    0
scope_3_category_4:_upstream_transportation_and_distribution_and_category_9:_downstream_transportation_and_distribution    0
unnamed:_2                                                                                                                 0
unnamed:_3                                                                                                                 0
unnamed:_4                                                                                                                 0
unnamed:_5                                                                                                                 3
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 9 ---
Shape: (250, 8)
Columns: [&#39;table_9&#39;, &#39;scope_3_category_5:_waste_generated_in_operations_and_category_12:_end-of-life_treatment_of_sold_products&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;, &#39;unnamed:_5&#39;, &#39;unnamed:_6&#39;, &#39;unnamed:_7&#39;]
First 5 rows:
          table_9  \
0             NaN   
1        Material   
2   Aluminum Cans   
3  Aluminum Ingot   
4      Steel Cans   

  scope_3_category_5:_waste_generated_in_operations_and_category_12:_end-of-life_treatment_of_sold_products  \
0              Metric Tons CO2e / Short Ton Material                                                          
1                                          RecycledA                                                          
2                                               0.06                                                          
3                                               0.04                                                          
4                                               0.32                                                          

    unnamed:_2  unnamed:_3  unnamed:_4  \
0          NaN         NaN         NaN   
1  LandfilledB  CombustedC  CompostedD   
2         0.02        0.01         NaN   
3         0.02        0.01         NaN   
4         0.02        0.01         NaN   

                                          unnamed:_5  \
0                                                NaN   
1  Anaerobically Digested (Dry Digestate with Cur...   
2                                                NaN   
3                                                NaN   
4                                                NaN   

                                          unnamed:_6 unnamed:_7  
0                                                NaN        NaN  
1  Anaerobically Digested (Wet  Digestate with Cu...       year  
2                                                NaN       2022  
3                                                NaN       2022  
4                                                NaN       2022  

Missing values per column:
table_9                                                                                                        4
scope_3_category_5:_waste_generated_in_operations_and_category_12:_end-of-life_treatment_of_sold_products    122
unnamed:_2                                                                                                     4
unnamed:_3                                                                                                    30
unnamed:_4                                                                                                   188
unnamed:_5                                                                                                   198
unnamed:_6                                                                                                   214
unnamed:_7                                                                                                     7
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 10 ---
Shape: (52, 6)
Columns: [&#39;table_10&#39;, &#39;scope_3_category_6:_business_travel_and_category_7:_employee_commuting&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;, &#39;unnamed:_5&#39;]
First 5 rows:
                                table_10  \
0                           Vehicle Type   
1                        Passenger Car A   
2                     Light-Duty Truck B   
3                             Motorcycle   
4  Intercity Rail - Northeast Corridor C   

  scope_3_category_6:_business_travel_and_category_7:_employee_commuting  \
0                           CO2 Factor \n(kg / unit)                       
1                                              0.332                       
2                                              0.454                       
3                                              0.183                       
4                                              0.058                       

                unnamed:_2               unnamed:_3      unnamed:_4 unnamed:_5  
0  CH4 Factor \n(g / unit)  N2O Factor \n(g / unit)           Units       year  
1                    0.007                    0.007    vehicle-mile       2022  
2                    0.012                    0.009    vehicle-mile       2022  
3                     0.07                    0.007    vehicle-mile       2022  
4                   0.0055                   0.0007  passenger-mile       2022  

Missing values per column:
table_10                                                                  0
scope_3_category_6:_business_travel_and_category_7:_employee_commuting    0
unnamed:_2                                                                0
unnamed:_3                                                                0
unnamed:_4                                                                0
unnamed:_5                                                                3
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 11 ---
Shape: (132, 4)
Columns: [&#39;table_11&#39;, &#39;global_warming_potential_gwp&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;]
First 5 rows:
                                   table_11 global_warming_potential_gwp  \
0  Industrial Designation or \nCommon Name             Chemical Formula    
1                            Carbon dioxide                          CO2   
2                                   Methane                          CH4   
3                             Nitrous oxide                          N2O   
4                                    HFC-23                         CHF3   

     unnamed:_2 unnamed:_3  
0  100-Year GWP       year  
1             1       2022  
2            25       2022  
3           298       2022  
4         14800       2022  

Missing values per column:
table_11                        0
global_warming_potential_gwp    0
unnamed:_2                      0
unnamed:_3                      1
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 12 ---
Shape: (136, 7)
Columns: [&#39;table_12&#39;, &#39;global_warming_potential_gwp_for_blended_refrigerants&#39;, &#39;unnamed:_2&#39;, &#39;unnamed:_3&#39;, &#39;unnamed:_4&#39;, &#39;unnamed:_5&#39;, &#39;unnamed:_6&#39;]
First 5 rows:
   table_12 global_warming_potential_gwp_for_blended_refrigerants  \
0  ASHRAE #                                       100-year GWP      
1    R-401A                                                 16      
2    R-401B                                                 14      
3    R-401C                                                 19      
4    R-402A                                               2100      

                                  unnamed:_2  unnamed:_3  unnamed:_4  \
0                          Blend Composition         NaN         NaN   
1  53% HCFC-22 , 34% HCFC-124 , 13% HFC-152a         NaN         NaN   
2  61% HCFC-22 , 28% HCFC-124 , 11% HFC-152a         NaN         NaN   
3  33% HCFC-22 , 52% HCFC-124 , 15% HFC-152a         NaN         NaN   
4      38% HCFC-22 , 6% HFC-125 , 2% propane         NaN         NaN   

   unnamed:_5 unnamed:_6  
0         NaN       Year  
1         NaN       2022  
2         NaN       2022  
3         NaN       2022  
4         NaN       2022  

Missing values per column:
table_12                                                   0
global_warming_potential_gwp_for_blended_refrigerants      0
unnamed:_2                                                 0
unnamed:_3                                               136
unnamed:_4                                               136
unnamed:_5                                               136
unnamed:_6                                                 3
dtype: int64
------------------------------------------------------------

--- Loading sheet: Table 13 ---
Shape: (11, 3)
Columns: [&#39;gas&#39;, &#39;100-year_gwp&#39;, &#39;year&#39;]
First 5 rows:
   gas  100-year_gwp  year
0  CH4            25  2022
1  N2O           298  2022
2  Gas  100-Year GWP  2023
3  CH4            25  2023
4  N2O           298  2023

Missing values per column:
gas             0
100-year_gwp    0
year            0
dtype: int64
------------------------------------------------------------
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="qnm6wOXn6IrH" data-outputId="98b13649-d853-4d8b-f640-a67ce0872187">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to clean column names</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_cols(df):</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Standardize column names: lower case, replace spaces and special chars.&quot;&quot;&quot;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [<span class="bu">str</span>(col).strip().lower()</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                  .replace(<span class="st">&#39; &#39;</span>, <span class="st">&#39;_&#39;</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                  .replace(<span class="st">&#39;(&#39;</span>, <span class="st">&#39;&#39;</span>).replace(<span class="st">&#39;)&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                  .replace(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&#39;_&#39;</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                  .replace(<span class="st">&#39;__&#39;</span>, <span class="st">&#39;_&#39;</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Load each sheet with correct header handling</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> {}</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1: Stationary Combustion (header row is second row)</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 1&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> clean_cols(df1)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 1&#39;</span>] <span class="op">=</span> df1</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2: Mobile Combustion CO2 (header row is second row)</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 2&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> clean_cols(df2)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 2&#39;</span>] <span class="op">=</span> df2</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 3: On‑Road Gasoline Vehicles CH4/N2O (header row is second row)</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 3&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> clean_cols(df3)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 3&#39;</span>] <span class="op">=</span> df3</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 4: On‑Road Diesel &amp; Alternative Fuel Vehicles (header row is second row)</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 4&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> clean_cols(df4)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 4&#39;</span>] <span class="op">=</span> df4</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 5: Non‑Road Vehicles (header row is second row)</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>df5 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 5&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>df5 <span class="op">=</span> clean_cols(df5)</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 5&#39;</span>] <span class="op">=</span> df5</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 6: Electricity (header row is third row)</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>df6 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 6&#39;</span>, header<span class="op">=</span><span class="dv">2</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>df6 <span class="op">=</span> clean_cols(df6)</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 6&#39;</span>] <span class="op">=</span> df6</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 7: Steam and Heat (header row is second row)</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>df7 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 7&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>df7 <span class="op">=</span> clean_cols(df7)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 7&#39;</span>] <span class="op">=</span> df7</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 8: Scope 3 Transportation (header row is second row)</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>df8 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 8&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>df8 <span class="op">=</span> clean_cols(df8)</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 8&#39;</span>] <span class="op">=</span> df8</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 9: Waste Treatment (header row is third row)</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>df9 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 9&#39;</span>, header<span class="op">=</span><span class="dv">2</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>df9 <span class="op">=</span> clean_cols(df9)</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 9&#39;</span>] <span class="op">=</span> df9</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 10: Business Travel &amp; Commuting (header row is second row)</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>df10 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 10&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>df10 <span class="op">=</span> clean_cols(df10)</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 10&#39;</span>] <span class="op">=</span> df10</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 11: GWP for Pure Gases (header row is second row)</span></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>df11 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 11&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>df11 <span class="op">=</span> clean_cols(df11)</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 11&#39;</span>] <span class="op">=</span> df11</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 12: GWP for Blended Refrigerants (header row is second row)</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>df12 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 12&#39;</span>, header<span class="op">=</span><span class="dv">1</span>, skiprows<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>df12 <span class="op">=</span> clean_cols(df12)</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 12&#39;</span>] <span class="op">=</span> df12</span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 13: Simplified GWP (header row is first row)</span></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>df13 <span class="op">=</span> pd.read_excel(xls, sheet_name<span class="op">=</span><span class="st">&#39;Table 13&#39;</span>, header<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>df13 <span class="op">=</span> clean_cols(df13)</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>dfs[<span class="st">&#39;Table 13&#39;</span>] <span class="op">=</span> df13</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to safely find a column by keyword or fallback to position</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_col(df, keywords, fallback_index<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a><span class="co">    Find a column that contains any of the keywords (case-insensitive).</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a><span class="co">    If not found, return the column at fallback_index (if provided) or None.</span></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> col.lower() <span class="cf">for</span> kw <span class="kw">in</span> keywords):</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> col</span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fallback_index <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> fallback_index <span class="op">&lt;</span> <span class="bu">len</span>(df.columns):</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df.columns[fallback_index]</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform exploratory analysis for each table</span></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------------------------------------------------------------------</span></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 1: Stationary Combustion ---</span></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table1(df):</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 1: Stationary Combustion ===&quot;</span>)</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify category rows (where heat content is missing)</span></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>    heat_col <span class="op">=</span> find_col(df, [<span class="st">&#39;heat_content&#39;</span>], fallback_index<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> heat_col:</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">&#39;is_category&#39;</span>] <span class="op">=</span> df[heat_col].isna()</span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">&#39;is_category&#39;</span>] <span class="op">=</span> df.iloc[:, <span class="dv">1</span>].isna()</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> df[df[<span class="st">&#39;is_category&#39;</span>]].iloc[:, <span class="dv">0</span>].tolist()</span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Fuel categories:&quot;</span>, categories)</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">&#39;is_category&#39;</span>]].copy()</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;Number of fuel entries: </span><span class="sc">{</span><span class="bu">len</span>(data)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find per-mmBtu columns</span></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>    co2_col <span class="op">=</span> find_col(df, [<span class="st">&#39;co2&#39;</span>, <span class="st">&#39;mmbtu&#39;</span>])</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>    ch4_col <span class="op">=</span> find_col(df, [<span class="st">&#39;ch4&#39;</span>, <span class="st">&#39;mmbtu&#39;</span>])</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>    n2o_col <span class="op">=</span> find_col(df, [<span class="st">&#39;n2o&#39;</span>, <span class="st">&#39;mmbtu&#39;</span>])</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> co2_col <span class="kw">and</span> ch4_col <span class="kw">and</span> n2o_col:</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> [co2_col, ch4_col, n2o_col]:</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>            data[col] <span class="op">=</span> pd.to_numeric(data[col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Summary statistics (per mmBtu):&quot;</span>)</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(data[[co2_col, ch4_col, n2o_col]].describe())</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Unique CH4 per mmBtu values:&quot;</span>, data[ch4_col].unique())</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Unique N2O per mmBtu values:&quot;</span>, data[n2o_col].unique())</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Distribution of CO2 factor</span></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a>        plt.figure()</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a>        sns.histplot(data[co2_col].dropna(), bins<span class="op">=</span><span class="dv">20</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">&#39;Distribution of CO2 Factor (kg/mmBtu) for Stationary Fuels&#39;</span>)</span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">&#39;kg CO2 per mmBtu&#39;</span>)</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Top 10 fuels by CO2 factor</span></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>        fuel_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a>        top_co2 <span class="op">=</span> data.nlargest(<span class="dv">10</span>, co2_col)[[fuel_col, co2_col]]</span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>        plt.figure()</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>        sns.barplot(data<span class="op">=</span>top_co2, y<span class="op">=</span>fuel_col, x<span class="op">=</span>co2_col, palette<span class="op">=</span><span class="st">&#39;Reds_r&#39;</span>)</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">&#39;Top 10 Fuels by CO2 Factor (per mmBtu)&#39;</span>)</span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Could not locate per-mmBtu columns.&quot;</span>)</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>analyze_table1(dfs[<span class="st">&#39;Table 1&#39;</span>])</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 2: Mobile Combustion CO2 ---</span></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table2(df):</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 2: Mobile Combustion CO2 ===&quot;</span>)</span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>    fuel_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>    unit_col <span class="op">=</span> df.columns[<span class="dv">2</span>]</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Duplicate fuel types:&quot;</span>, df[fuel_col].duplicated().<span class="bu">any</span>())</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Units present:&quot;</span>, df[unit_col].unique())</span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a>analyze_table2(dfs[<span class="st">&#39;Table 2&#39;</span>])</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 3: On‑Road Gasoline Vehicles CH4/N2O ---</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table3(df):</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 3: On-Road Gasoline Vehicles CH4/N2O ===&quot;</span>)</span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify year column (reporting year)</span></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> find_col(df, [<span class="st">&#39;year&#39;</span>], fallback_index<span class="op">=-</span><span class="dv">1</span>)  <span class="co"># last column</span></span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;No year column found.&quot;</span>)</span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure year column is numeric</span></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Reporting years:&quot;</span>, years)</span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify other columns</span></span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>    vehicle_col <span class="op">=</span> df.columns[<span class="dv">0</span>]  <span class="co"># first column is vehicle type</span></span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a>    model_year_col <span class="op">=</span> df.columns[<span class="dv">1</span>]  <span class="co"># second column is model year</span></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>    ch4_col <span class="op">=</span> find_col(df, [<span class="st">&#39;ch4&#39;</span>])</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>    n2o_col <span class="op">=</span> find_col(df, [<span class="st">&#39;n2o&#39;</span>])</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ch4_col <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> n2o_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Could not find CH4 or N2O columns.&quot;</span>)</span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> yr <span class="kw">in</span> years:</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[year_col] <span class="op">==</span> yr].copy()</span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a>        cars <span class="op">=</span> sub[sub[vehicle_col].<span class="bu">str</span>.contains(<span class="st">&#39;Passenger Cars&#39;</span>, na<span class="op">=</span><span class="va">False</span>)].copy()</span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> cars.empty:</span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Parse model year ranges into a numeric midpoint</span></span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>            <span class="kw">def</span> extract_year(m):</span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pd.isna(m):</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> np.nan</span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a>                m <span class="op">=</span> <span class="bu">str</span>(m).strip()</span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;-&#39;</span> <span class="kw">in</span> m:</span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>                    parts <span class="op">=</span> m.split(<span class="st">&#39;-&#39;</span>)</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a>                        start <span class="op">=</span> <span class="bu">int</span>(parts[<span class="dv">0</span>])</span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>                        end <span class="op">=</span> <span class="bu">int</span>(parts[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> (start <span class="op">+</span> end) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> np.nan</span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">int</span>(m)</span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> np.nan</span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>            cars[<span class="st">&#39;model_year_num&#39;</span>] <span class="op">=</span> cars[model_year_col].<span class="bu">apply</span>(extract_year)</span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>            cars <span class="op">=</span> cars.dropna(subset<span class="op">=</span>[<span class="st">&#39;model_year_num&#39;</span>]).sort_values(<span class="st">&#39;model_year_num&#39;</span>)</span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Convert factor columns to numeric</span></span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a>            cars[ch4_col] <span class="op">=</span> pd.to_numeric(cars[ch4_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a>            cars[n2o_col] <span class="op">=</span> pd.to_numeric(cars[n2o_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>            plt.figure()</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>            plt.plot(cars[<span class="st">&#39;model_year_num&#39;</span>], cars[ch4_col], marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, label<span class="op">=</span><span class="st">&#39;CH4&#39;</span>)</span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>            plt.plot(cars[<span class="st">&#39;model_year_num&#39;</span>], cars[n2o_col], marker<span class="op">=</span><span class="st">&#39;s&#39;</span>, label<span class="op">=</span><span class="st">&#39;N2O&#39;</span>)</span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">&#39;Model Year&#39;</span>)</span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">&#39;g/mile&#39;</span>)</span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f&#39;Gasoline Passenger Cars CH4/N2O Factors - </span><span class="sc">{</span>yr<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>)</span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a>analyze_table3(dfs[<span class="st">&#39;Table 3&#39;</span>])</span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 4: On‑Road Diesel &amp; Alternative Fuel Vehicles ---</span></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table4(df):</span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 4: On-Road Diesel &amp; Alternative Fuel Vehicles ===&quot;</span>)</span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> find_col(df, [<span class="st">&#39;year&#39;</span>], fallback_index<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;No year column found.&quot;</span>)</span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Reporting years:&quot;</span>, years)</span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a>    vehicle_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a>    fuel_col <span class="op">=</span> df.columns[<span class="dv">1</span>]</span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a>    model_year_col <span class="op">=</span> df.columns[<span class="dv">2</span>]</span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a>    ch4_col <span class="op">=</span> find_col(df, [<span class="st">&#39;ch4&#39;</span>])</span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a>    n2o_col <span class="op">=</span> find_col(df, [<span class="st">&#39;n2o&#39;</span>])</span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ch4_col <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> n2o_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Could not find CH4 or N2O columns.&quot;</span>)</span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot diesel passenger cars trend</span></span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> yr <span class="kw">in</span> years:</span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[year_col] <span class="op">==</span> yr].copy()</span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a>        diesel_cars <span class="op">=</span> sub[(sub[vehicle_col] <span class="op">==</span> <span class="st">&#39;Passenger Cars&#39;</span>) <span class="op">&amp;</span> (sub[fuel_col] <span class="op">==</span> <span class="st">&#39;Diesel&#39;</span>)].copy()</span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> diesel_cars.empty:</span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a>            <span class="kw">def</span> extract_year(m):</span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> pd.isna(m):</span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> np.nan</span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a>                m <span class="op">=</span> <span class="bu">str</span>(m).strip()</span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">&#39;-&#39;</span> <span class="kw">in</span> m:</span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a>                    parts <span class="op">=</span> m.split(<span class="st">&#39;-&#39;</span>)</span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a>                        start <span class="op">=</span> <span class="bu">int</span>(parts[<span class="dv">0</span>])</span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a>                        end <span class="op">=</span> <span class="bu">int</span>(parts[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> (start <span class="op">+</span> end) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> np.nan</span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">try</span>:</span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="bu">int</span>(m)</span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">except</span>:</span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> np.nan</span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a>            diesel_cars[<span class="st">&#39;model_year_num&#39;</span>] <span class="op">=</span> diesel_cars[model_year_col].<span class="bu">apply</span>(extract_year)</span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a>            diesel_cars <span class="op">=</span> diesel_cars.dropna(subset<span class="op">=</span>[<span class="st">&#39;model_year_num&#39;</span>]).sort_values(<span class="st">&#39;model_year_num&#39;</span>)</span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a>            diesel_cars[ch4_col] <span class="op">=</span> pd.to_numeric(diesel_cars[ch4_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a>            diesel_cars[n2o_col] <span class="op">=</span> pd.to_numeric(diesel_cars[n2o_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a>            plt.figure()</span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a>            plt.plot(diesel_cars[<span class="st">&#39;model_year_num&#39;</span>], diesel_cars[ch4_col], marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, label<span class="op">=</span><span class="st">&#39;CH4&#39;</span>)</span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a>            plt.plot(diesel_cars[<span class="st">&#39;model_year_num&#39;</span>], diesel_cars[n2o_col], marker<span class="op">=</span><span class="st">&#39;s&#39;</span>, label<span class="op">=</span><span class="st">&#39;N2O&#39;</span>)</span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">&#39;Model Year&#39;</span>)</span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">&#39;g/mile&#39;</span>)</span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f&#39;Diesel Passenger Cars CH4/N2O Factors - </span><span class="sc">{</span>yr<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>)</span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a>analyze_table4(dfs[<span class="st">&#39;Table 4&#39;</span>])</span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 5: Non‑Road Vehicles ---</span></span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table5(df):</span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 5: Non-Road Vehicles ===&quot;</span>)</span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> find_col(df, [<span class="st">&#39;year&#39;</span>], fallback_index<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;No year column found.&quot;</span>)</span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Reporting years:&quot;</span>, years)</span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a>    vehicle_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a>    fuel_col <span class="op">=</span> df.columns[<span class="dv">1</span>]</span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a>    ch4_col <span class="op">=</span> find_col(df, [<span class="st">&#39;ch4&#39;</span>])</span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a>    n2o_col <span class="op">=</span> find_col(df, [<span class="st">&#39;n2o&#39;</span>])</span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ch4_col <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> n2o_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Could not find CH4 or N2O columns.&quot;</span>)</span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by vehicle type and fuel to see average factors</span></span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> df.groupby([vehicle_col, fuel_col])[[ch4_col, n2o_col]].mean()</span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Average factors by vehicle and fuel:&quot;</span>)</span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(summary)</span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot CH4 factor for a few equipment types</span></span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a>    equip_list <span class="op">=</span> [<span class="st">&#39;Ships and Boats&#39;</span>, <span class="st">&#39;Locomotives&#39;</span>, <span class="st">&#39;Aircraft&#39;</span>, <span class="st">&#39;Agricultural EquipmentA&#39;</span>]</span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> equip <span class="kw">in</span> equip_list:</span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[vehicle_col] <span class="op">==</span> equip]</span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sub.empty:</span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a>            plt.figure()</span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a>            sns.barplot(data<span class="op">=</span>sub, x<span class="op">=</span>fuel_col, y<span class="op">=</span>ch4_col, hue<span class="op">=</span>year_col, ci<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f&#39;CH4 Factor for </span><span class="sc">{</span>equip<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a>            plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a>analyze_table5(dfs[<span class="st">&#39;Table 5&#39;</span>])</span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 6: Electricity ---</span></span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table6(df):</span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 6: Electricity ===&quot;</span>)</span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> find_col(df, [<span class="st">&#39;year&#39;</span>], fallback_index<span class="op">=-</span><span class="dv">2</span>)  <span class="co"># second last column often year</span></span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;No year column found.&quot;</span>)</span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Years present:&quot;</span>, years)</span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify CO2 columns: total output and non-baseload</span></span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a>    co2_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> df.columns <span class="cf">if</span> <span class="st">&#39;co2&#39;</span> <span class="kw">in</span> c]</span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(co2_cols) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a>        total_col <span class="op">=</span> co2_cols[<span class="dv">0</span>]</span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a>        nonbase_col <span class="op">=</span> co2_cols[<span class="dv">1</span>]</span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Could not identify CO2 columns.&quot;</span>)</span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a>    subregion_col <span class="op">=</span> df.columns[<span class="dv">0</span>]  <span class="co"># eGRID subregion</span></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> yr <span class="kw">in</span> years:</span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[year_col] <span class="op">==</span> yr].copy()</span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a>        sub[total_col] <span class="op">=</span> pd.to_numeric(sub[total_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a>        sub[nonbase_col] <span class="op">=</span> pd.to_numeric(sub[nonbase_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> sub.dropna(subset<span class="op">=</span>[total_col, nonbase_col]).sort_values(total_col, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(sub))</span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a>        plt.bar(x, sub[total_col], width<span class="op">=</span><span class="fl">0.4</span>, label<span class="op">=</span><span class="st">&#39;Total Output&#39;</span>, align<span class="op">=</span><span class="st">&#39;center&#39;</span>)</span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a>        plt.bar([i<span class="op">+</span><span class="fl">0.4</span> <span class="cf">for</span> i <span class="kw">in</span> x], sub[nonbase_col], width<span class="op">=</span><span class="fl">0.4</span>, label<span class="op">=</span><span class="st">&#39;Non-Baseload&#39;</span>, align<span class="op">=</span><span class="st">&#39;center&#39;</span>)</span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a>        plt.xticks([i<span class="op">+</span><span class="fl">0.2</span> <span class="cf">for</span> i <span class="kw">in</span> x], sub[subregion_col], rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">&#39;CO2 Factor (lb/MWh)&#39;</span>)</span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f&#39;CO2 Emission Factors by eGRID Subregion - </span><span class="sc">{</span>yr<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>analyze_table6(dfs[<span class="st">&#39;Table 6&#39;</span>])</span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 7: Steam and Heat ---</span></span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table7(df):</span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 7: Steam and Heat ===&quot;</span>)</span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df)</span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a>analyze_table7(dfs[<span class="st">&#39;Table 7&#39;</span>])</span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 8: Scope 3 Transportation ---</span></span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table8(df):</span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 8: Scope 3 Transportation ===&quot;</span>)</span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Expected structure:</span></span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a>    <span class="co"># col0: vehicle_type, col1: co2, col2: ch4, col3: n2o, col4: units, col5: year</span></span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.shape[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="dv">6</span>:</span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Unexpected number of columns; cannot analyze.&quot;</span>)</span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a>    vehicle_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a>    co2_col <span class="op">=</span> df.columns[<span class="dv">1</span>]</span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a>    ch4_col <span class="op">=</span> df.columns[<span class="dv">2</span>]</span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a>    n2o_col <span class="op">=</span> df.columns[<span class="dv">3</span>]</span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a>    units_col <span class="op">=</span> df.columns[<span class="dv">4</span>]</span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> df.columns[<span class="dv">5</span>]</span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure year column is numeric</span></span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Years:&quot;</span>, years)</span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> yr <span class="kw">in</span> years:</span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[year_col] <span class="op">==</span> yr]</span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert factor columns to numeric (some may be strings)</span></span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> sub.copy()</span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a>        sub[co2_col] <span class="op">=</span> pd.to_numeric(sub[co2_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a>        sub[ch4_col] <span class="op">=</span> pd.to_numeric(sub[ch4_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a>        sub[n2o_col] <span class="op">=</span> pd.to_numeric(sub[n2o_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Year </span><span class="sc">{</span>yr<span class="sc">}</span><span class="ss">:&quot;</span>)</span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(sub[[vehicle_col, co2_col, ch4_col, n2o_col, units_col]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a>analyze_table8(dfs[<span class="st">&#39;Table 8&#39;</span>])</span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 9: Waste Treatment ---</span></span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table9(df):</span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 9: Waste Treatment ===&quot;</span>)</span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> find_col(df, [<span class="st">&#39;year&#39;</span>], fallback_index<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;No year column found.&quot;</span>)</span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Years:&quot;</span>, years)</span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a>    material_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find landfilled column (likely named something like &#39;landfilledb&#39; after cleaning)</span></span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a>    landfilled_col <span class="op">=</span> find_col(df, [<span class="st">&#39;landfilled&#39;</span>])</span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> landfilled_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Could not find landfilled column. Available columns:&quot;</span>, df.columns.tolist())</span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> yr <span class="kw">in</span> years:</span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[year_col] <span class="op">==</span> yr].copy()</span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a>        sub[landfilled_col] <span class="op">=</span> pd.to_numeric(sub[landfilled_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> sub.dropna(subset<span class="op">=</span>[landfilled_col])</span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sub.empty:</span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;No data for year </span><span class="sc">{</span>yr<span class="sc">}</span><span class="ss"> in landfilled column.&quot;</span>)</span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a>        top_landfill <span class="op">=</span> sub.nlargest(<span class="dv">10</span>, landfilled_col)[[material_col, landfilled_col]]</span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a>        plt.figure()</span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a>        sns.barplot(data<span class="op">=</span>top_landfill, y<span class="op">=</span>material_col, x<span class="op">=</span>landfilled_col, palette<span class="op">=</span><span class="st">&#39;Blues_d&#39;</span>)</span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="ss">f&#39;Top 10 Materials by Landfill CO2e per Short Ton - </span><span class="sc">{</span>yr<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">&#39;Metric tons CO2e / short ton&#39;</span>)</span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a>analyze_table9(dfs[<span class="st">&#39;Table 9&#39;</span>])</span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 10: Business Travel &amp; Commuting ---</span></span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table10(df):</span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 10: Business Travel &amp; Commuting ===&quot;</span>)</span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Same structure as Table 8: 6 columns</span></span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.shape[<span class="dv">1</span>] <span class="op">&lt;</span> <span class="dv">6</span>:</span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Unexpected number of columns; cannot analyze.&quot;</span>)</span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a>    vehicle_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a>    co2_col <span class="op">=</span> df.columns[<span class="dv">1</span>]</span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a>    ch4_col <span class="op">=</span> df.columns[<span class="dv">2</span>]</span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a>    n2o_col <span class="op">=</span> df.columns[<span class="dv">3</span>]</span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a>    units_col <span class="op">=</span> df.columns[<span class="dv">4</span>]</span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> df.columns[<span class="dv">5</span>]</span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Years:&quot;</span>, years)</span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> yr <span class="kw">in</span> years:</span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[year_col] <span class="op">==</span> yr].copy()</span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a>        sub[co2_col] <span class="op">=</span> pd.to_numeric(sub[co2_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a>        sub[ch4_col] <span class="op">=</span> pd.to_numeric(sub[ch4_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a>        sub[n2o_col] <span class="op">=</span> pd.to_numeric(sub[n2o_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Year </span><span class="sc">{</span>yr<span class="sc">}</span><span class="ss">:&quot;</span>)</span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(sub[[vehicle_col, co2_col, ch4_col, n2o_col, units_col]].to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a>analyze_table10(dfs[<span class="st">&#39;Table 10&#39;</span>])</span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 11: GWP for Pure Gases ---</span></span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table11(df):</span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 11: GWP for Pure Gases ===&quot;</span>)</span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> find_col(df, [<span class="st">&#39;year&#39;</span>], fallback_index<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;No year column found.&quot;</span>)</span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Years:&quot;</span>, years)</span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a>    gas_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a>    gwp_col <span class="op">=</span> find_col(df, [<span class="st">&#39;gwp&#39;</span>])</span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> gwp_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Could not find GWP column.&quot;</span>)</span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a>    key_gases <span class="op">=</span> [<span class="st">&#39;Methane&#39;</span>, <span class="st">&#39;Nitrous oxide&#39;</span>, <span class="st">&#39;HFC-134a&#39;</span>, <span class="st">&#39;Sulfur hexafluoride&#39;</span>]</span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gas <span class="kw">in</span> key_gases:</span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[gas_col].<span class="bu">str</span>.contains(gas, na<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> sub.empty:</span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a>            plt.figure()</span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a>            plt.plot(sub[year_col], sub[gwp_col], marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="ss">f&#39;GWP Trend for </span><span class="sc">{</span>gas<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">&#39;Year&#39;</span>)</span>
<span id="cb35-498"><a href="#cb35-498" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">&#39;100-year GWP&#39;</span>)</span>
<span id="cb35-499"><a href="#cb35-499" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>)</span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a>analyze_table11(dfs[<span class="st">&#39;Table 11&#39;</span>])</span>
<span id="cb35-504"><a href="#cb35-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-505"><a href="#cb35-505" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 12: GWP for Blended Refrigerants ---</span></span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table12(df):</span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 12: GWP for Blended Refrigerants ===&quot;</span>)</span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a>    year_col <span class="op">=</span> find_col(df, [<span class="st">&#39;year&#39;</span>], fallback_index<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;No year column found.&quot;</span>)</span>
<span id="cb35-511"><a href="#cb35-511" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-512"><a href="#cb35-512" aria-hidden="true" tabindex="-1"></a>    df[year_col] <span class="op">=</span> pd.to_numeric(df[year_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> df[year_col].dropna().unique()</span>
<span id="cb35-514"><a href="#cb35-514" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Years:&quot;</span>, years)</span>
<span id="cb35-515"><a href="#cb35-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a>    ashrae_col <span class="op">=</span> df.columns[<span class="dv">0</span>]</span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a>    gwp_col <span class="op">=</span> find_col(df, [<span class="st">&#39;gwp&#39;</span>])</span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> gwp_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-519"><a href="#cb35-519" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Could not find GWP column.&quot;</span>)</span>
<span id="cb35-520"><a href="#cb35-520" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> yr <span class="kw">in</span> years:</span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df[df[year_col] <span class="op">==</span> yr].copy()</span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a>        sub[gwp_col] <span class="op">=</span> pd.to_numeric(sub[gwp_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a>        top <span class="op">=</span> sub.nlargest(<span class="dv">10</span>, gwp_col)[[ashrae_col, gwp_col]]</span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Year </span><span class="sc">{</span>yr<span class="sc">}</span><span class="ss"> - Top 10 High-GWP Blends:&quot;</span>)</span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(top.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a>analyze_table12(dfs[<span class="st">&#39;Table 12&#39;</span>])</span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Table 13: Simplified GWP ---</span></span>
<span id="cb35-532"><a href="#cb35-532" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_table13(df):</span>
<span id="cb35-533"><a href="#cb35-533" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Table 13: Simplified GWP ===&quot;</span>)</span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df)</span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a>analyze_table13(dfs[<span class="st">&#39;Table 13&#39;</span>])</span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== EDA Complete ===&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
=== Table 1: Stationary Combustion ===
Fuel categories: [&#39;Coal and Coke&#39;, &#39;Other Fuels - Solid&#39;, &#39;Biomass Fuels - Solid&#39;, &#39;Natural Gas&#39;, &#39;Other Fuels - Gaseous&#39;, &#39;Biomass Fuels - Gaseous&#39;, &#39;Petroleum Products&#39;, &#39;Biomass Fuels - Liquid&#39;, &#39;Biomass Fuels - \nKraft Pulping Liquor, by Wood Furnish&#39;, &#39;North American Softwood&#39;, &#39;North American Hardwood&#39;, &#39;Bagasse&#39;, &#39;Bamboo&#39;, &#39;Straw&#39;]
Number of fuel entries: 60

Summary statistics (per mmBtu):
       mmbtu_per_short_ton  mmbtu_per_short_ton  mmbtu_per_short_ton
count            58.000000            58.000000            58.000000
mean              6.037944             6.037944             6.037944
std              10.311884            10.311884            10.311884
min               0.000092             0.000092             0.000092
25%               0.103000             0.103000             0.103000
50%               0.136500             0.136500             0.136500
75%               9.525000             9.525000             9.525000
max              38.000000            38.000000            38.000000

Unique CH4 per mmBtu values: [2.509e+01 2.493e+01 1.725e+01 1.421e+01 2.139e+01 1.973e+01 2.628e+01
 2.235e+01 2.480e+01 9.950e+00 3.000e+01 3.800e+01 2.800e+01 8.250e+00
 8.000e+00 1.039e+01 1.748e+01       nan 1.026e-03 9.200e-05 5.990e-04
 1.388e-03 2.516e-03 4.850e-04 6.550e-04 1.580e-01 1.200e-01 1.030e-01
 1.050e-01 1.380e-01 1.390e-01 1.460e-01 6.800e-02 5.800e-02 1.480e-01
 9.900e-02 1.350e-01 9.200e-02 1.440e-01 1.250e-01 1.100e-01 9.100e-02
 1.400e-01 1.500e-01 1.280e-01 8.400e-02]
Unique N2O per mmBtu values: [2.509e+01 2.493e+01 1.725e+01 1.421e+01 2.139e+01 1.973e+01 2.628e+01
 2.235e+01 2.480e+01 9.950e+00 3.000e+01 3.800e+01 2.800e+01 8.250e+00
 8.000e+00 1.039e+01 1.748e+01       nan 1.026e-03 9.200e-05 5.990e-04
 1.388e-03 2.516e-03 4.850e-04 6.550e-04 1.580e-01 1.200e-01 1.030e-01
 1.050e-01 1.380e-01 1.390e-01 1.460e-01 6.800e-02 5.800e-02 1.480e-01
 9.900e-02 1.350e-01 9.200e-02 1.440e-01 1.250e-01 1.100e-01 9.100e-02
 1.400e-01 1.500e-01 1.280e-01 8.400e-02]
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/a9af713e1bb7667206ae69ec91426b61e473459d.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/2de365dc4312e8384c8a1f31fb6ff7cc2c37786d.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>
=== Table 2: Mobile Combustion CO2 ===
              aviation_gasoline     8.31 gallon
               Biodiesel (100%)  9.45000 gallon
   Compressed Natural Gas (CNG)  0.05444    scf
                    Diesel Fuel 10.21000 gallon
                 Ethanol (100%)  5.75000 gallon
         Kerosene-Type Jet Fuel  9.75000 gallon
    Liquefied Natural Gas (LNG)  4.50000 gallon
Liquefied Petroleum Gases (LPG)  5.68000 gallon
                 Motor Gasoline  8.78000 gallon
              Residual Fuel Oil 11.27000 gallon

Duplicate fuel types: False
Units present: [&#39;gallon&#39; &#39;scf&#39;]

=== Table 3: On-Road Gasoline Vehicles CH4/N2O ===
Reporting years: [2022. 2023. 2024. 2025.]
Could not find CH4 or N2O columns.

=== Table 4: On-Road Diesel &amp; Alternative Fuel Vehicles ===
Reporting years: [2022. 2023. 2024. 2025.]
Could not find CH4 or N2O columns.

=== Table 5: Non-Road Vehicles ===
Reporting years: [2022. 2023. 2024. 2025.]
Could not find CH4 or N2O columns.

=== Table 6: Electricity ===
Years present: [2022. 2023. 2024. 2025.]
Could not identify CO2 columns.

=== Table 7: Steam and Heat ===
Empty DataFrame
Columns: [steam_and_heat, 66.33, 1.25, 0.125]
Index: []

=== Table 8: Scope 3 Transportation ===
Years: [2022. 2023. 2024. 2025.]

Year 2022.0:
medium-_and_heavy-duty_truck  1.45  0.013  0.034 vehicle-mile
             Passenger Car A 0.332 0.0070 0.0070 vehicle-mile
          Light-Duty Truck B 0.454 0.0120 0.0090 vehicle-mile
Medium- and Heavy-Duty Truck 0.211 0.0020 0.0049     ton-mile
                        Rail 0.022 0.0017 0.0006     ton-mile
            Waterborne Craft 0.041 0.0183 0.0008     ton-mile
                   AircraftC 1.165 0.0000 0.0359     ton-mile

Year 2023.0:
 medium-_and_heavy-duty_truck  1.45  0.013  0.034 vehicle-mile
 Medium- and Heavy-Duty Truck 1.387 0.0130 0.0380 vehicle-mile
              Passenger Car A 0.313 0.0080 0.0070 vehicle-mile
           Light-Duty Truck B 0.467 0.0130 0.0120 vehicle-mile
Medium- and Heavy-Duty TruckC 0.170 0.0016 0.0047     ton-mile
                         Rail 0.021 0.0016 0.0005     ton-mile
             Waterborne Craft 0.044 0.0254 0.0011     ton-mile
                     Aircraft 0.698 0.0000 0.0215     ton-mile

Year 2024.0:
 medium-_and_heavy-duty_truck     1.45    0.013    0.034   vehicle-mile
 Medium- and Heavy-Duty Truck 1.359787 0.011909 0.037748   vehicle-mile
              Passenger Car A 0.306131 0.008986 0.006013   vehicle-mile
           Light-Duty Truck B 0.405456 0.011071 0.009826   vehicle-mile
Medium- and Heavy-Duty TruckC 0.168043 0.001472 0.004665 short ton-mile
                         Rail 0.021893 0.001711 0.000547 short ton-mile
             Waterborne Craft 0.082102 0.032580 0.002065 short ton-mile
                     Aircraft 0.904815 0.000000 0.027861 short ton-mile

Year 2025.0:
 medium-_and_heavy-duty_truck  1.45  0.013  0.034   vehicle-mile
 Medium- and Heavy-Duty Truck 1.298 0.0115 0.0376   vehicle-mile
              Passenger Car A 0.297 0.0059 0.0053   vehicle-mile
           Light-Duty Truck B 0.394 0.0109 0.0088   vehicle-mile
Medium- and Heavy-Duty TruckC 0.186 0.0016 0.0054 short ton-mile
                         Rail 0.021 0.0016 0.0005 short ton-mile
             Waterborne Craft 0.077 0.0310 0.0020 short ton-mile
                     Aircraft 1.086 0.0000 0.0334 short ton-mile

=== Table 9: Waste Treatment ===
Years: [2022. 2023. 2024. 2025.]
Could not find landfilled column. Available columns: [&#39;aluminum_ingot&#39;, &#39;0.04&#39;, &#39;0.02&#39;, &#39;0.01&#39;, &#39;na&#39;, &#39;na.1&#39;, &#39;na.2&#39;, &#39;2022&#39;]

=== Table 10: Business Travel &amp; Commuting ===
Years: [2022. 2023. 2024. 2025.]

Year 2022.0:
                                         passenger_car_a  0.332  0.007  0.007.1   vehicle-mile
                                      Light-Duty Truck B  0.454 0.0120   0.0090   vehicle-mile
                                              Motorcycle  0.183 0.0700   0.0070   vehicle-mile
                   Intercity Rail - Northeast Corridor C  0.058 0.0055   0.0007 passenger-mile
                         Intercity Rail - Other Routes C  0.150 0.0117   0.0038 passenger-mile
                     Intercity Rail - National Average C  0.113 0.0092   0.0026 passenger-mile
                                         Commuter Rail D  0.139 0.0112   0.0028 passenger-mile
                      Transit Rail (i.e. Subway, Tram) E  0.099 0.0084   0.0012 passenger-mile
                                                     Bus  0.056 0.0210   0.0009 passenger-mile
                  Air Travel - Short Haul (&lt; 300 miles)   0.207 0.0064   0.0066 passenger-mile
Air Travel - Medium Haul (&gt;= 300 miles, \n&lt; 2300 miles)   0.129 0.0006   0.0041 passenger-mile
                 Air Travel - Long Haul (&gt;= 2300 miles)   0.163 0.0006   0.0052 passenger-mile

Year 2023.0:
                                         passenger_car_a  0.332  0.007  0.007.1   vehicle-mile
                                         Passenger Car A  0.313 0.0080   0.0070   vehicle-mile
                                      Light-Duty Truck B  0.467 0.0130   0.0120   vehicle-mile
                                              Motorcycle  0.178 0.1110   0.0190   vehicle-mile
                   Intercity Rail - Northeast Corridor C  0.058 0.0055   0.0007 passenger-mile
                         Intercity Rail - Other Routes C  0.150 0.0117   0.0038 passenger-mile
                     Intercity Rail - National Average C  0.113 0.0092   0.0026 passenger-mile
                                         Commuter Rail D  0.135 0.0109   0.0027 passenger-mile
                      Transit Rail (i.e. Subway, Tram) E  0.096 0.0080   0.0011 passenger-mile
                                                     Bus  0.055 0.0063   0.0011 passenger-mile
                  Air Travel - Short Haul (&lt; 300 miles)   0.207 0.0064   0.0066 passenger-mile
Air Travel - Medium Haul (&gt;= 300 miles, \n&lt; 2300 miles)   0.129 0.0006   0.0041 passenger-mile
                 Air Travel - Long Haul (&gt;= 2300 miles)   0.163 0.0006   0.0052 passenger-mile

Year 2024.0:
                                       passenger_car_a    0.332    0.007  0.007.1   vehicle-mile
                                       Passenger Car A 0.306131 0.008986 0.006013   vehicle-mile
                                    Light-Duty Truck B 0.405456 0.011071 0.009826   vehicle-mile
                                            Motorcycle 0.375635 0.090645 0.019212   vehicle-mile
                 Intercity Rail - Northeast Corridor C 0.058000 0.005500 0.000700 passenger-mile
                       Intercity Rail - Other Routes C 0.150000 0.011700 0.003800 passenger-mile
                   Intercity Rail - National Average C 0.113000 0.009200 0.002600 passenger-mile
                                       Commuter Rail D 0.133312 0.010522 0.002610 passenger-mile
                    Transit Rail (i.e. Subway, Tram) E 0.093069 0.007462 0.001018 passenger-mile
                                                   Bus 0.070708 0.005030 0.002126 passenger-mile
                Air Travel - Short Haul (&lt; 300 miles)  0.206929 0.006431 0.006582 passenger-mile
Air Travel - Medium Haul (&gt;= 300 miles, &lt; 2300 miles)  0.129260 0.000643 0.004100 passenger-mile
               Air Travel - Long Haul (&gt;= 2300 miles)  0.162556 0.000643 0.005179 passenger-mile

Year 2025.0:
                                       passenger_car_a  0.332  0.007  0.007.1   vehicle-mile
                                       Passenger Car A  0.297 0.0059   0.0053   vehicle-mile
                                    Light-Duty Truck B  0.394 0.0109   0.0088   vehicle-mile
                                            Motorcycle  0.368 0.0888   0.0188   vehicle-mile
                 Intercity Rail - Northeast Corridor C  0.023 0.0010   0.0001 passenger-mile
                       Intercity Rail - Other Routes C  0.149 0.0120   0.0040 passenger-mile
                   Intercity Rail - National Average C  0.096 0.0080   0.0020 passenger-mile
                                       Commuter Rail D  0.133 0.0105   0.0026 passenger-mile
                    Transit Rail (i.e. Subway, Tram) E  0.093 0.0075   0.0010 passenger-mile
                                                   Bus  0.066 0.0046   0.0019 passenger-mile
                Air Travel - Short Haul (&lt; 300 miles)   0.207 0.0064   0.0066 passenger-mile
Air Travel - Medium Haul (&gt;= 300 miles, &lt; 2300 miles)   0.129 0.0006   0.0041 passenger-mile
               Air Travel - Long Haul (&gt;= 2300 miles)   0.163 0.0006   0.0052 passenger-mile

=== Table 11: GWP for Pure Gases ===
Years: [2022. 2023. 2024. 2025.]
Could not find GWP column.

=== Table 12: GWP for Blended Refrigerants ===
Years: [2022. 2023. 2024. 2025.]
Could not find GWP column.

=== Table 13: Simplified GWP ===
    gas  100-year_gwp  year
0   CH4            25  2022
1   N2O           298  2022
2   Gas  100-Year GWP  2023
3   CH4            25  2023
4   N2O           298  2023
5   Gas  100-Year GWP  2024
6   CH4            28  2024
7   N2O           265  2024
8   Gas  100-Year GWP  2025
9   CH4            28  2025
10  N2O           265  2025

=== EDA Complete ===
</code></pre>
</div>
</div>
<div class="cell markdown" id="GjU4ZZ0JxFhW">
<p>The dataset consists of 13 tables (worksheets) that provide emission
factors for greenhouse gas (GHG) inventories. The factors are organized
by source category (stationary combustion, mobile combustion,
electricity, etc.) and cover multiple years (2022–2025). Each table is
structured with clear headers, units, and footnotes. Below is a detailed
analysis of each table, including structure, key variables, data
quality, and notable observations.</p>
<p><strong>Table 1: Stationary Combustion</strong></p>
<p>Purpose: Provides emission factors for fuels used in stationary
equipment (boilers, heaters, etc.). Factors are given per unit of energy
(mmBtu) and per physical unit (short ton, scf, gallon) for CO₂, CH₄, and
N₂O.</p>
<p>Structure:</p>
<ul>
<li>Rows are grouped by fuel category: Coal and Coke, Other Fuels -
Solid, Biomass Fuels - Solid, Natural Gas, Other Fuels - Gaseous,
Biomass Fuels - Gaseous, Petroleum Products, Biomass Fuels - Liquid, and
Kraft Pulping Liquor.</li>
<li>Columns:
<ul>
<li>Fuel Type</li>
<li>Heat Content (mmBtu per short ton / scf / gallon) – note that the
unit changes depending on fuel type.</li>
<li>CO₂ Factor (kg CO₂ per mmBtu)</li>
<li>CH₄ Factor (g CH₄ per mmBtu)</li>
<li>N₂O Factor (g N₂O per mmBtu)</li>
<li>CO₂ Factor (kg per physical unit)</li>
<li>CH₄ Factor (g per physical unit)</li>
<li>N₂O Factor (g per physical unit)</li>
</ul></li>
<li>Units are explicitly given in a row below headers.</li>
</ul>
<p>Key Observations:</p>
<ul>
<li>Missing heat content values for some rows (e.g., Kraft pulping
liquor rows have no heat content; only factors per mmBtu are
provided).</li>
<li>The table appears to be a static reference (likely the values are
constant across all years).</li>
<li>Fuel types are granular (e.g., different coal ranks, various
petroleum products).</li>
<li>CH₄ and N₂O factors are often constant across many fuels (e.g., for
most petroleum products, CH₄ = 3 g/mmBtu, N₂O = 0.6 g/mmBtu), but some
have different values (e.g., biomass fuels have lower CH₄ and N₂O).</li>
<li>Some values are marked "NA" (e.g., for some biomass fuels, certain
factors are missing).</li>
</ul>
<p>Potential Use: Calculating direct emissions from fuel combustion in
stationary sources.</p>
<p><strong>Table 2: Mobile Combustion CO₂</strong></p>
<p>Purpose: Provides CO₂ emission factors for various transportation
fuels, per physical unit (gallon or scf).</p>
<p>Structure:</p>
<ul>
<li>Columns: Fuel Type, kg CO₂ per unit, Unit.</li>
<li>10 rows covering common mobile fuels (gasoline, diesel, CNG,
etc.)</li>
</ul>
<p>Observations:</p>
<ul>
<li>The table appears to be a static reference (likely the values are
constant across all years).</li>
<li>Units vary: most are gallons, CNG is scf.</li>
<li>Factors align with Table 1 for corresponding fuels (e.g., Motor
Gasoline = 8.78 kg/gallon matches Table 1's motor gasoline per gallon
value).</li>
</ul>
<p>Potential Use: Calculating CO₂ emissions from mobile sources when
fuel consumption is known.</p>
<p><strong>Table 3: Mobile Combustion CH₄ and N₂O for On‑Road Gasoline
Vehicles</strong></p>
<p>Purpose: Provides CH₄ and N₂O emission factors (g/mile) for
gasoline‑powered on‑road vehicles, disaggregated by vehicle type, model
year, and data year (2022–2025).</p>
<p>Structure:</p>
<ul>
<li>Vehicle types: Passenger Cars, Light‑Duty Trucks, Heavy‑Duty
Vehicles, Motorcycles.</li>
<li>For each type, rows list model year ranges and corresponding CH₄ and
N₂O factors.</li>
<li>The table is repeated for reporting years 2022, 2023, 2024, and
2025, each with updated factors (especially for recent model
years).</li>
<li>Columns: Vehicle Type, Model Year, CH₄ Factor (g/mile), N₂O Factor
(g/mile), and a final column indicating the reporting year</li>
</ul>
<p>Key Observations:</p>
<ul>
<li>Factors vary significantly by model year, reflecting improving
emission controls.</li>
<li>For the same model year, factors sometimes change across reporting
years (e.g., 2019 passenger cars: 0.0051 CH₄ in 2022, but 0.005105 in
2024). This suggests annual updates to the underlying data.</li>
<li>Some entries have zero values (e.g., motorcycles 1996–2005 in
2023/2024 have 0 CH₄ and N₂O).</li>
<li>Heavy‑duty vehicles show much higher factors, especially for older
models.</li>
<li>The structure is consistent across years, with new model years added
progressively (e.g., 2020, 2021, 2022 appear in later reporting
years).</li>
</ul>
<p>Potential Use: Estimating non‑CO₂ emissions from gasoline vehicle
fleets when vehicle‑miles traveled and model year distribution are
known.</p>
<p><strong>Table 4: Mobile Combustion CH₄ and N₂O for On‑Road Diesel and
Alternative Fuel Vehicles</strong></p>
<p>Purpose: Provides CH₄ and N₂O factors (g/mile) for diesel and
alternative‑fuel vehicles (ethanol, CNG, LPG, biodiesel, etc.) by
vehicle type and model year.</p>
<p>Structure:</p>
<ul>
<li>Similar to Table 3, but includes fuel type as a column.</li>
<li>Vehicle types: Passenger Cars, Light‑Duty Trucks, Medium‑ and
Heavy‑Duty Vehicles, plus categories for Light‑Duty Cars/Trucks
(alternative fuels) and Medium/Heavy trucks and buses.</li>
<li>For diesel vehicles, factors are given by model year ranges; for
alternative fuels, often a single factor (no year dependence).</li>
<li>Repeated for years 2022–2025, with slight adjustments.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Diesel factors have distinct tiers: pre‑1982, 1983–2006, and 2007+
(with higher CH₄ for newer vehicles due to after‑treatment).</li>
<li>Alternative fuel factors vary widely (e.g., CNG buses have very high
CH₄ factors ~10 g/mile in 2022, but lower in later years).</li>
<li>Some values change notably across years (e.g., medium‑duty trucks
CNG went from 4.2 in 2022 to 1.829 in 2023 to 1.807 in 2024).</li>
<li>N₂O factors for diesel heavy‑duty vehicles are relatively high
(0.0431 for 2007+).</li>
</ul>
<p>Potential Use: Estimating non‑CO₂ emissions from diesel and
alternative‑fuel vehicles.</p>
<p><strong>Table 5: Mobile Combustion CH₄ and N₂O for Non‑Road
Vehicles</strong></p>
<p>Purpose: Provides CH₄ and N₂O factors (g/gallon) for off‑road
equipment (ships, locomotives, aircraft, agricultural, construction,
etc.).</p>
<p>Structure:</p>
<ul>
<li>Rows grouped by vehicle/equipment type (e.g., Ships and Boats,
Locomotives, Agricultural Equipment).</li>
<li>Columns: Fuel Type, CH₄ Factor (g/gal), N₂O Factor (g/gal), and
Year.</li>
<li>Repeated for 2022–2025.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Factors are given per gallon of fuel consumed.</li>
<li>Many equipment types have multiple fuel options (gasoline 2‑stroke
vs. 4‑stroke, diesel, LPG).</li>
<li>Values change across years (e.g., agricultural equipment gasoline
2‑stroke CH₄ went from 9.19 in 2022 to 6.92 in 2023, then 6.9 in
2025).</li>
<li>Some factors are zero (e.g., aircraft jet fuel CH₄ = 0).</li>
<li>Units are consistent (g/gal) except for aircraft (still g/gal).</li>
</ul>
<p>Potential Use: Estimating non‑CO₂ emissions from non‑road mobile
sources using fuel consumption data.</p>
<p><strong>Table 6: Electricity</strong></p>
<p>Purpose: Provides CO₂, CH₄, and N₂O emission factors per MWh for
electricity consumption, disaggregated by eGRID subregion. Includes both
total output and non‑baseload factors.</p>
<p>Structure:</p>
<ul>
<li>Columns: eGRID Subregion, CO₂ Factor (lb/MWh), CH₄ Factor (lb/MWh),
N₂O Factor (lb/MWh), repeated for total output and non‑baseload.</li>
<li>Each block is followed by a row with the reporting year (2022, 2023,
2024, 2025).</li>
<li>In 2025, an additional column "Grid Gross Loss (%)" is
included.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Subregion codes (e.g., AKGD, CAMX) are explained in the first
column.</li>
<li>Factors vary widely by region (e.g., NYUP has low CO₂ ~233 lb/MWh in
2022, while HIOA has high ~1653).</li>
<li>Non‑baseload factors are generally higher than total output,
reflecting marginal generation.</li>
<li>Values are updated annually; some regions show significant changes
(e.g., NYCW total output CO₂: 634.6 in 2022 → 816.8 in 2023 → 885.2 in
2024 → 974.7 in 2025).</li>
<li>In 2025, grid loss percentages (around 4%) are added, likely for
calculating upstream emissions.</li>
</ul>
<p>Potential Use: Calculating indirect emissions from purchased
electricity (Scope 2) based on location and consumption.</p>
<p><strong>Table 7: Steam and Heat</strong></p>
<p>Purpose: Provides emission factors for purchased steam or heat.</p>
<p>Structure:</p>
<ul>
<li>Single row with CO₂ (kg/mmBtu), CH₄ (g/mmBtu), N₂O (g/mmBtu).</li>
<li>All year (2022-2025) presumably constant.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Simple table; factors are 66.33 kg CO₂/mmBtu, 1.25 g CH₄/mmBtu,
0.125 g N₂O/mmBtu.</li>
</ul>
<p>Potential Use: Calculating emissions from purchased steam or district
heating.</p>
<p><strong>Table 8: Scope 3 Categories 4 and 9 – Upstream and Downstream
Transportation</strong></p>
<p>Purpose: Provides emission factors for transportation and
distribution activities (by vehicle type) in Scope 3.</p>
<p>Structure:</p>
<ul>
<li>Rows: Vehicle types (Medium/Heavy‑Duty Truck, Passenger Car, Rail,
Waterborne, Aircraft) with factors per vehicle‑mile or ton‑mile.</li>
<li>Columns: CO₂ (kg/unit), CH₄ (g/unit), N₂O (g/unit), Units,
Year.</li>
<li>Repeated for 2022–2025.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Two types of units: vehicle‑mile and ton‑mile (short ton‑mile).</li>
<li>Factors are updated annually; e.g., Medium/Heavy‑Duty Truck
(vehicle‑mile) CO₂: 1.45 (2022) → 1.387 (2023) → 1.360 (2024) → 1.298
(2025).</li>
<li>Some factors show non‑monotonic changes (e.g., waterborne craft
ton‑mile CH₄: 0.0183 (2022) → 0.0254 (2023) → 0.0326 (2024) → 0.031
(2025)).</li>
<li>Aircraft factors per ton‑mile are relatively high in CO₂.</li>
</ul>
<p>Potential Use: Estimating Scope 3 emissions from transportation of
goods.</p>
<p><strong>Table 9: Scope 3 Categories 5 and 12 – Waste Generated in
Operations and End‑of‑Life Treatment</strong></p>
<p>Purpose: Provides CO₂e factors per short ton of material for
different waste treatment methods (recycled, landfilled, combusted,
composted, anaerobically digested).</p>
<p>Structure:</p>
<ul>
<li>Rows: Material types (e.g., Aluminum Cans, HDPE, Food Waste,
etc.)</li>
<li>Columns: Treatment method (Recycled, Landfilled, Combusted,
Composted, Anaerobic digestion variants) with values in metric tons CO₂e
per short ton.</li>
<li>Each block is repeated for 2022–2025, with slight updates.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Many entries are "NA" where a treatment is not applicable (e.g.,
composting for metals).</li>
<li>Values vary by material and treatment. For example, landfilling
paper has high CO₂e (0.9–1.25) due to methane generation, while
combustion of plastics yields high CO₂e (2.8).</li>
<li>Some values change across years (e.g., landfilled corrugated
containers: 0.9 in 2022 → 1.0 in 2023+; food waste landfilled: 0.58 →
0.67/0.69).</li>
<li>New materials appear in later years (e.g., structural steel added in
2024).</li>
<li>Units are consistent (metric tons CO₂e per short ton).</li>
</ul>
<p>Potential Use: Calculating Scope 3 emissions from waste disposal and
end‑of‑life treatment of sold products.</p>
<p><strong>Table 10: Scope 3 Categories 6 and 7 – Business Travel and
Employee Commuting</strong></p>
<p>Purpose: Provides emission factors per passenger‑mile or vehicle‑mile
for various travel modes.</p>
<p>Structure:</p>
<ul>
<li>Rows: Travel modes (Passenger Car, Light‑Duty Truck, Motorcycle,
Rail types, Bus, Air Travel by distance).</li>
<li>Columns: CO₂ (kg/unit), CH₄ (g/unit), N₂O (g/unit), Units,
Year.</li>
<li>Repeated for 2022–2025.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Units vary: vehicle‑mile for cars/trucks/motorcycles; passenger‑mile
for rail, bus, air.</li>
<li>Air travel factors are broken into short, medium, long haul.</li>
<li>Values change across years (e.g., motorcycle CO₂: 0.183 (2022) →
0.178 (2023) → 0.376 (2024) → 0.368 (2025) – note the jump in 2024,
likely due to methodology change).</li>
<li>Some rail factors remain constant (e.g., intercity rail Northeast
Corridor unchanged 2022–2024, but changed in 2025).</li>
<li>Bus CH₄ factor dropped dramatically from 0.021 (2022) to 0.0063
(2023) and then 0.005/0.0046.</li>
</ul>
<p>Potential Use: Estimating Scope 3 emissions from employee commuting
and business travel.</p>
<p><strong>Table 11: Global Warming Potentials (GWP) for Pure
Gases</strong></p>
<p>Purpose: Provides 100‑year GWP values for common greenhouse gases and
refrigerants.</p>
<p>Structure:</p>
<ul>
<li>Columns: Gas name, Chemical formula, 100‑year GWP, Year.</li>
<li>Repeated for 2022–2025.</li>
</ul>
<p>Observations:</p>
<ul>
<li>GWP values change over time, reflecting updates in scientific
assessment (e.g., CH₄: 25 in 2022/2023 → 28 in 2024/2025; N₂O: 298 →
265).</li>
<li>Many HFCs and PFCs are listed, with values that sometimes shift
significantly (e.g., HFC‑23: 14800 → 12400).</li>
<li>The year 2024 uses updated IPCC AR5/AR6 values.</li>
<li>Some values are approximate (e.g., &gt;7,500 for C10F18 in
2022/2023).</li>
</ul>
<p>Potential Use: Converting emissions of different gases to CO₂e for
inventory reporting.</p>
<p><strong>Table 12: GWP for Blended Refrigerants</strong></p>
<p>Purpose: Provides 100‑year GWP values for common refrigerant blends
(ASHRAE numbers).</p>
<p>Structure:</p>
<ul>
<li>Columns: ASHRAE #, 100‑year GWP, Blend Composition.</li>
<li>Repeated for 2022–2025, with slight updates in GWP values and
compositions.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Blend compositions are given in percentages.</li>
<li>GWPs change across years (e.g., R‑404A: 3922 in 2022/2023 → 3943 in
2024/2025).</li>
<li>Some blends have GWP = 0 (e.g., R‑406A, R‑409A) because they contain
no high‑GWP components.</li>
<li>Compositions are sometimes refined in later years (e.g., R‑424A
composition expanded in 2024).</li>
</ul>
<p>Potential Use: Calculating emissions from refrigerant leaks using
blend‑specific GWPs.</p>
<p><strong>Table 13: Simplified GWP for CH₄ and N₂O</strong></p>
<p>Purpose: Provides a quick reference for CH₄ and N₂O GWP values,
presumably for use with other tables where only these two gases are
needed.</p>
<p>Structure:</p>
<ul>
<li>Simple two‑row table with Gas and 100‑year GWP, repeated for each
year.</li>
</ul>
<p>Observations:</p>
<ul>
<li>Values match Table 11 for CH₄ and N₂O.</li>
<li>This table might be redundant but serves as a concise lookup.</li>
</ul>
</div>
<div class="cell markdown" id="5k-iNUdJJIsy">
<p>#<strong>Modelling</strong></p>
</div>
<div class="cell code" id="t9zOSM5tIvJz">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_score</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span></code></pre></div>
</div>
<div class="cell markdown" id="9eAys9LpJRXe">
<p>#<strong>Research Question 1: Sectoral Emission
Benchmarking</strong></p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="E9rue8WyPeT9" data-outputId="d4b976e8-682c-456b-e7ca-4c05c5773115">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Research Question 1: Sectoral Emission Benchmarking</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RQ1: Sectoral Emission Benchmarking&quot;</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the &#39;GHG&#39; sheet</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#df = data[&#39;GHG&#39;].copy()</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">=== Data for RQ1 ===&quot;</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Columns in GHG sheet:&quot;</span>, df_GHG.columns.tolist())</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">First few rows of the GHG sheet:&quot;</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_GHG.head())</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Identify the correct column names</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Option A: Try automatic detection (may fail)</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>naics_col <span class="op">=</span> <span class="va">None</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>sef_col   <span class="op">=</span> <span class="va">None</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Look for a column containing &#39;naics&#39;</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df_GHG.columns:</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;naics&#39;</span> <span class="kw">in</span> col.lower():</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>        naics_col <span class="op">=</span> col</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Look for a column containing total emission factor</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Try common patterns: &#39;total&#39;, &#39;sef&#39;, &#39;emission&#39;, &#39;supplychain&#39;, etc.</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>possible_sef_keywords <span class="op">=</span> [<span class="st">&#39;total&#39;</span>, <span class="st">&#39;sef&#39;</span>, <span class="st">&#39;emission&#39;</span>, <span class="st">&#39;supplychain&#39;</span>, <span class="st">&#39;co2e&#39;</span>]</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df_GHG.columns:</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    lower <span class="op">=</span> col.lower()</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(kw <span class="kw">in</span> lower <span class="cf">for</span> kw <span class="kw">in</span> possible_sef_keywords):</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Prefer columns with &#39;total&#39; and &#39;sef&#39; together, but accept any match</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>        sef_col <span class="op">=</span> col</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Auto-detected NAICS column: </span><span class="sc">{</span>naics_col<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Auto-detected SEF column: </span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="co"># If auto-detection failed, ask user to manually enter the column names</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> naics_col <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sef_col <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;!&quot;</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Auto-detection could not find the required columns.&quot;</span>)</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Please enter the correct column names based on the list above.&quot;</span>)</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>    naics_col <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Enter the name of the column containing NAICS codes: &quot;</span>).strip()</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    sef_col   <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Enter the name of the column containing the total SEF (kg CO₂e per USD): &quot;</span>).strip()</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> naics_col <span class="kw">not</span> <span class="kw">in</span> df_GHG.columns <span class="kw">or</span> sef_col <span class="kw">not</span> <span class="kw">in</span> df_GHG.columns:</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;One of the entered column names does not exist in the DataFrame.&quot;</span>)</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Using NAICS column: </span><span class="sc">{</span>naics_col<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Using SEF column: </span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create sector labels (Manufacturing vs Services)</span></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_sector(naics):</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>    naics_str <span class="op">=</span> <span class="bu">str</span>(naics).strip()</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> naics_str.startswith((<span class="st">&#39;31&#39;</span>, <span class="st">&#39;32&#39;</span>, <span class="st">&#39;33&#39;</span>)):</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Manufacturing&#39;</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> naics_str.startswith((<span class="st">&#39;51&#39;</span>, <span class="st">&#39;52&#39;</span>, <span class="st">&#39;53&#39;</span>, <span class="st">&#39;54&#39;</span>, <span class="st">&#39;55&#39;</span>, <span class="st">&#39;56&#39;</span>)):</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Services&#39;</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;Other&#39;</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>df_GHG[<span class="st">&#39;sector&#39;</span>] <span class="op">=</span> df_GHG[naics_col].<span class="bu">apply</span>(assign_sector)</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to keep only Manufacturing and Services</span></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>df_rq1 <span class="op">=</span> df_GHG[df_GHG[<span class="st">&#39;sector&#39;</span>].isin([<span class="st">&#39;Manufacturing&#39;</span>, <span class="st">&#39;Services&#39;</span>])].copy()</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Sector counts for RQ1:&quot;</span>)</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_rq1[<span class="st">&#39;sector&#39;</span>].value_counts())</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Descriptive statistics</span></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>mfg <span class="op">=</span> df_rq1[df_rq1[<span class="st">&#39;sector&#39;</span>] <span class="op">==</span> <span class="st">&#39;Manufacturing&#39;</span>][sef_col]</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>svc <span class="op">=</span> df_rq1[df_rq1[<span class="st">&#39;sector&#39;</span>] <span class="op">==</span> <span class="st">&#39;Services&#39;</span>][sef_col]</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Descriptive Statistics for Manufacturing SEF ---&quot;</span>)</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mfg.describe())</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Descriptive Statistics for Services SEF ---&quot;</span>)</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(svc.describe())</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Visual comparison (boxplot)</span></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>data_to_plot <span class="op">=</span> [mfg, svc]</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>plt.boxplot(data_to_plot, labels<span class="op">=</span>[<span class="st">&#39;Manufacturing&#39;</span>, <span class="st">&#39;Services&#39;</span>])</span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="ss">f&#39;</span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss"> (kg CO₂e per USD)&#39;</span>)</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Supply Chain Emission Factors by Sector&#39;</span>)</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Normality tests (Shapiro-Wilk)</span></span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Shapiro-Wilk Normality Test ---&quot;</span>)</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>shapiro_mfg <span class="op">=</span> stats.shapiro(mfg)</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>shapiro_svc <span class="op">=</span> stats.shapiro(svc)</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Manufacturing: statistic=</span><span class="sc">{</span>shapiro_mfg<span class="sc">.</span>statistic<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>shapiro_mfg<span class="sc">.</span>pvalue<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Services: statistic=</span><span class="sc">{</span>shapiro_svc<span class="sc">.</span>statistic<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>shapiro_svc<span class="sc">.</span>pvalue<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Hypothesis testing</span></span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Hypothesis Tests for Difference in Means ---&quot;</span>)</span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Welch&#39;s t-test (does not assume equal variance)</span></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>t_stat, t_p <span class="op">=</span> stats.ttest_ind(mfg, svc, equal_var<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Welch&#39;s t-test: t = </span><span class="sc">{</span>t_stat<span class="sc">:.4f}</span><span class="ss">, p-value = </span><span class="sc">{</span>t_p<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Mann-Whitney U test (non-parametric)</span></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>u_stat, u_p <span class="op">=</span> stats.mannwhitneyu(mfg, svc, alternative<span class="op">=</span><span class="st">&#39;two-sided&#39;</span>)</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Mann-Whitney U test: U = </span><span class="sc">{</span>u_stat<span class="sc">:.4f}</span><span class="ss">, p-value = </span><span class="sc">{</span>u_p<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 7: Effect size (Cohen&#39;s d)</span></span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>pooled_std <span class="op">=</span> np.sqrt((mfg.std()<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> svc.std()<span class="op">**</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>cohens_d <span class="op">=</span> (mfg.mean() <span class="op">-</span> svc.mean()) <span class="op">/</span> pooled_std</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Cohen&#39;s d effect size: </span><span class="sc">{</span>cohens_d<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 8: Interpretation</span></span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> u_p <span class="op">&lt;</span> alpha:</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Conclusion: Reject null hypothesis. There is a significant difference in mean SEF between Manufacturing and Services.&quot;</span>)</span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Conclusion: Fail to reject null hypothesis. No significant difference detected.&quot;</span>)</span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">abs</span>(cohens_d) <span class="op">&lt;</span> <span class="fl">0.2</span>:</span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Effect size is negligible.&quot;</span>)</span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">abs</span>(cohens_d) <span class="op">&lt;</span> <span class="fl">0.5</span>:</span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Effect size is small.&quot;</span>)</span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">abs</span>(cohens_d) <span class="op">&lt;</span> <span class="fl">0.8</span>:</span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Effect size is medium.&quot;</span>)</span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Effect size is large.&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
============================================================
RQ1: Sectoral Emission Benchmarking
============================================================

=== Data for RQ1 ===
Columns in GHG sheet: [&#39;2017 NAICS Code&#39;, &#39;2017 NAICS Title&#39;, &#39;GHG&#39;, &#39;Unit&#39;, &#39;Supply Chain Emission Factors without Margins&#39;, &#39;Margins of Supply Chain Emission Factors&#39;, &#39;Supply Chain Emission Factors with Margins&#39;, &#39;Reference USEEIO Code&#39;, &#39;NAICS_Sector&#39;, &#39;Sector&#39;, &#39;GHG_Category&#39;, &#39;Margin_Ratio&#39;]

First few rows of the GHG sheet:
   2017 NAICS Code 2017 NAICS Title                   GHG  \
0           111110  Soybean Farming                HFC-23   
1           111110  Soybean Farming        Carbon dioxide   
2           111110  Soybean Farming             HFC-236fa   
3           111110  Soybean Farming  Carbon tetrafluoride   
4           111110  Soybean Farming                HFC-32   

                           Unit  \
0  kg/2022 USD, purchaser price   
1  kg/2022 USD, purchaser price   
2  kg/2022 USD, purchaser price   
3  kg/2022 USD, purchaser price   
4  kg/2022 USD, purchaser price   

   Supply Chain Emission Factors without Margins  \
0                                   3.230000e-09   
1                                   1.340000e-01   
2                                   1.440000e-10   
3                                   5.130000e-09   
4                                   3.000000e-08   

   Margins of Supply Chain Emission Factors  \
0                              1.340000e-09   
1                              3.780000e-02   
2                              2.020000e-10   
3                              5.970000e-09   
4                              4.200000e-08   

   Supply Chain Emission Factors with Margins Reference USEEIO Code  \
0                                4.570000e-09                1111A0   
1                                1.720000e-01                1111A0   
2                                3.450000e-10                1111A0   
3                                1.110000e-08                1111A0   
4                                7.200000e-08                1111A0   

  NAICS_Sector                          Sector GHG_Category  Margin_Ratio  
0           11  Agriculture, Forestry, Fishing         HFCs      0.414861  
1           11  Agriculture, Forestry, Fishing          CO₂      0.282090  
2           11  Agriculture, Forestry, Fishing         HFCs      1.402778  
3           11  Agriculture, Forestry, Fishing        Other      1.163743  
4           11  Agriculture, Forestry, Fishing         HFCs      1.400000  

Auto-detected NAICS column: 2017 NAICS Code
Auto-detected SEF column: Supply Chain Emission Factors without Margins

Using NAICS column: 2017 NAICS Code
Using SEF column: Supply Chain Emission Factors without Margins

Sector counts for RQ1:
sector
Manufacturing    6462
Services         3456
Name: count, dtype: int64

--- Descriptive Statistics for Manufacturing SEF ---
count    6.462000e+03
mean     1.425077e-02
std      8.830044e-02
min      4.180000e-11
25%      1.920000e-09
50%      2.215000e-08
75%      2.140000e-07
max      3.790000e+00
Name: Supply Chain Emission Factors without Margins, dtype: float64

--- Descriptive Statistics for Services SEF ---
count    3.456000e+03
mean     5.040667e-03
std      2.396865e-02
min      1.970000e-11
25%      1.120000e-09
50%      1.000000e-08
75%      3.807500e-07
max      2.380000e-01
Name: Supply Chain Emission Factors without Margins, dtype: float64
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/2d5f3ab546be522ac380270ed834c6f7e34650cf.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>
--- Shapiro-Wilk Normality Test ---
Manufacturing: statistic=0.1467, p-value=0.0000
Services: statistic=0.2183, p-value=0.0000

--- Hypothesis Tests for Difference in Means ---
Welch&#39;s t-test: t = 7.8606, p-value = 0.0000
Mann-Whitney U test: U = 11910775.5000, p-value = 0.0000
Cohen&#39;s d effect size: 0.1424

Conclusion: Reject null hypothesis. There is a significant difference in mean SEF between Manufacturing and Services.
Effect size is negligible.
</code></pre>
</div>
</div>
<div class="cell markdown" id="7dKFnVACJmlq">
<p>#<strong>Research Question 2: Margin Correlation
Analysis</strong></p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="_ZX3Ee69Zzz6" data-outputId="8ed32729-3a7e-45f7-a776-862b661e5b25">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">Research Question 2: Margin Correlation Analysis</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr, spearmanr</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set visualization style</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&#39;whitegrid&#39;</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">&#39;figure.figsize&#39;</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">6</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;RQ2: Margin Correlation Analysis&quot;</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Data Overview (df_CO2) ---&quot;</span>)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;df_CO2 shape: </span><span class="sc">{</span>df_CO2<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">First 5 rows of df_CO2:&quot;</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_CO2.head())</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Column names in df_CO2:&quot;</span>)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_CO2.columns.tolist())</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Identify the correct columns for SEF and MEF</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on user information:</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>sef_col <span class="op">=</span> <span class="st">&quot;Supply Chain Emission Factors without Margins&quot;</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>mef_col <span class="op">=</span> <span class="st">&quot;Margins of Supply Chain Emission Factors&quot;</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>total_col <span class="op">=</span> <span class="st">&quot;Supply Chain Emission Factors with Margins&quot;</span>  <span class="co"># optional verification</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify that these columns exist in df_CO2</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>missing <span class="op">=</span> []</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> sef_col <span class="kw">not</span> <span class="kw">in</span> df_CO2.columns:</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>    missing.append(sef_col)</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> mef_col <span class="kw">not</span> <span class="kw">in</span> df_CO2.columns:</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>    missing.append(mef_col)</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> missing:</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">KeyError</span>(<span class="ss">f&quot;Columns not found in df_CO2: </span><span class="sc">{</span>missing<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Using SEF column: &#39;</span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Using MEF column: &#39;</span><span class="sc">{</span>mef_col<span class="sc">}</span><span class="ss">&#39;&quot;</span>)</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the two variables as numeric, coercing errors</span></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>sef <span class="op">=</span> pd.to_numeric(df_CO2[sef_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>mef <span class="op">=</span> pd.to_numeric(df_CO2[mef_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>valid_mask <span class="op">=</span> <span class="op">~</span>(sef.isna() <span class="op">|</span> mef.isna())</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>sef <span class="op">=</span> sef[valid_mask]</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>mef <span class="op">=</span> mef[valid_mask]</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Number of valid observations after cleaning: </span><span class="sc">{</span><span class="bu">len</span>(sef)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;This should be close to the expected 1,016 commodities.&quot;</span>)</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Quick sanity check that SEF + MEF ≈ total_col (if present)</span></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> total_col <span class="kw">in</span> df_CO2.columns:</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> pd.to_numeric(df_CO2.loc[valid_mask, total_col], errors<span class="op">=</span><span class="st">&#39;coerce&#39;</span>)</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>    diff <span class="op">=</span> (sef <span class="op">+</span> mef) <span class="op">-</span> total</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>    max_diff <span class="op">=</span> np.<span class="bu">abs</span>(diff).<span class="bu">max</span>()</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Sanity check: max difference between (SEF+MEF) and &#39;</span><span class="sc">{</span>total_col<span class="sc">}</span><span class="ss">&#39;: </span><span class="sc">{</span>max_diff<span class="sc">:.2e}</span><span class="ss"> (should be near zero).&quot;</span>)</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Descriptive Statistics (as per EDA)</span></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Descriptive Statistics ---&quot;</span>)</span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;SEF (Supply Chain Emission Factor without Margins):&quot;</span>)</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sef.describe())</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">MEF (Margin Emission Factor):&quot;</span>)</span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mef.describe())</span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Assumption Checks for Pearson Correlation</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Assumption Checks ---&quot;</span>)</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.1 Linearity: Scatter plot</span></span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>sef, y<span class="op">=</span>mef, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="ss">f&#39;</span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss"> (kg CO₂e per USD)&#39;</span>)</span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="ss">f&#39;</span><span class="sc">{</span>mef_col<span class="sc">}</span><span class="ss"> (kg CO₂e per USD)&#39;</span>)</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Scatter Plot: SEF vs MEF (Linearity Check)&#39;</span>)</span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.2 Normality (Shapiro-Wilk) - for reference only</span></span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Normality Tests (Shapiro-Wilk):&quot;</span>)</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a>shapiro_sef <span class="op">=</span> stats.shapiro(sef)</span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a>shapiro_mef <span class="op">=</span> stats.shapiro(mef)</span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;SEF: statistic=</span><span class="sc">{</span>shapiro_sef<span class="sc">.</span>statistic<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>shapiro_sef<span class="sc">.</span>pvalue<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MEF: statistic=</span><span class="sc">{</span>shapiro_mef<span class="sc">.</span>statistic<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>shapiro_mef<span class="sc">.</span>pvalue<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Note: Low p-values indicate non-normality, common in economic data. Pearson correlation is robust with large N.&quot;</span>)</span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.3 Outlier Detection (boxplots and Z-scores)</span></span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">5</span>))</span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a>sns.boxplot(y<span class="op">=</span>sef, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="ss">f&#39;</span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss"> Boxplot&#39;</span>)</span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>sns.boxplot(y<span class="op">=</span>mef, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="ss">f&#39;</span><span class="sc">{</span>mef_col<span class="sc">}</span><span class="ss"> Boxplot&#39;</span>)</span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a>z_sef <span class="op">=</span> np.<span class="bu">abs</span>(stats.zscore(sef))</span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a>z_mef <span class="op">=</span> np.<span class="bu">abs</span>(stats.zscore(mef))</span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a>outliers <span class="op">=</span> (z_sef <span class="op">&gt;</span> <span class="dv">3</span>) <span class="op">|</span> (z_mef <span class="op">&gt;</span> <span class="dv">3</span>)</span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Number of potential outliers (|Z|&gt;3 in either variable): </span><span class="sc">{</span>outliers<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;These outliers represent extreme sectors (e.g., cement, agriculture) and are valid data points.&quot;</span>)</span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Core Correlation Analysis</span></span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;CORE CORRELATION ANALYSIS&quot;</span>)</span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.1 Pearson Correlation (linear)</span></span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>pearson_r, pearson_p <span class="op">=</span> pearsonr(sef, mef)</span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">Pearson correlation: r = </span><span class="sc">{</span>pearson_r<span class="sc">:.4f}</span><span class="ss">, p-value = </span><span class="sc">{</span>pearson_p<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.2 Spearman Correlation (monotonic, robust)</span></span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a>spearman_rho, spearman_p <span class="op">=</span> spearmanr(sef, mef)</span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Spearman correlation: ρ = </span><span class="sc">{</span>spearman_rho<span class="sc">:.4f}</span><span class="ss">, p-value = </span><span class="sc">{</span>spearman_p<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.3 Confidence Interval for Pearson (Fisher Z)</span></span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> pearson_r</span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(sef)</span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> np.log((<span class="dv">1</span> <span class="op">+</span> r) <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> r))</span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> np.sqrt(n <span class="op">-</span> <span class="dv">3</span>)</span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>ci_z_lower <span class="op">=</span> z <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> se</span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>ci_z_upper <span class="op">=</span> z <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> se</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>ci_r_lower <span class="op">=</span> (np.exp(<span class="dv">2</span> <span class="op">*</span> ci_z_lower) <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (np.exp(<span class="dv">2</span> <span class="op">*</span> ci_z_lower) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>ci_r_upper <span class="op">=</span> (np.exp(<span class="dv">2</span> <span class="op">*</span> ci_z_upper) <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (np.exp(<span class="dv">2</span> <span class="op">*</span> ci_z_upper) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;95% Confidence Interval for Pearson r: [</span><span class="sc">{</span>ci_r_lower<span class="sc">:.4f}</span><span class="ss">, </span><span class="sc">{</span>ci_r_upper<span class="sc">:.4f}</span><span class="ss">]&quot;</span>)</span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Enhanced Visualizations</span></span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Generating Enhanced Plots ---&quot;</span>)</span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.1 Scatter with regression line</span></span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>sef, y<span class="op">=</span>mef, scatter_kws<span class="op">=</span>{<span class="st">&#39;alpha&#39;</span>:<span class="fl">0.5</span>, <span class="st">&#39;s&#39;</span>:<span class="dv">15</span>}, line_kws<span class="op">=</span>{<span class="st">&#39;color&#39;</span>:<span class="st">&#39;red&#39;</span>})</span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="ss">f&#39;</span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss"> (kg CO₂e per USD)&#39;</span>)</span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="ss">f&#39;</span><span class="sc">{</span>mef_col<span class="sc">}</span><span class="ss"> (kg CO₂e per USD)&#39;</span>)</span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&#39;SEF vs MEF with Regression Line (r = </span><span class="sc">{</span>pearson_r<span class="sc">:.3f}</span><span class="ss">)&#39;</span>)</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.2 Hexbin plot (density)</span></span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>plt.hexbin(sef, mef, gridsize<span class="op">=</span><span class="dv">40</span>, cmap<span class="op">=</span><span class="st">&#39;Blues&#39;</span>, mincnt<span class="op">=</span><span class="dv">1</span>, bins<span class="op">=</span><span class="st">&#39;log&#39;</span>)</span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">&#39;Log10(Count)&#39;</span>)</span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="ss">f&#39;</span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss"> (kg CO₂e per USD)&#39;</span>)</span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="ss">f&#39;</span><span class="sc">{</span>mef_col<span class="sc">}</span><span class="ss"> (kg CO₂e per USD)&#39;</span>)</span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Hexbin Plot: SEF vs MEF (Density View)&#39;</span>)</span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.3 Distribution histograms</span></span>
<span id="cb42-167"><a href="#cb42-167" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">5</span>))</span>
<span id="cb42-168"><a href="#cb42-168" aria-hidden="true" tabindex="-1"></a>sns.histplot(sef, kde<span class="op">=</span><span class="va">True</span>, bins<span class="op">=</span><span class="dv">30</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb42-169"><a href="#cb42-169" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="ss">f&#39;Distribution of </span><span class="sc">{</span>sef_col<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a>sns.histplot(mef, kde<span class="op">=</span><span class="va">True</span>, bins<span class="op">=</span><span class="dv">30</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="ss">f&#39;Distribution of </span><span class="sc">{</span>mef_col<span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-173"><a href="#cb42-173" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb42-174"><a href="#cb42-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Interpretation and Business Implications</span></span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;INTERPRETATION &amp; BUSINESS IMPLICATIONS&quot;</span>)</span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb42-181"><a href="#cb42-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-182"><a href="#cb42-182" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">The Pearson correlation coefficient is </span><span class="sc">{</span>pearson_r<span class="sc">:.3f}</span><span class="ss">.&quot;</span>)</span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">abs</span>(pearson_r) <span class="op">&gt;</span> <span class="fl">0.7</span>:</span>
<span id="cb42-184"><a href="#cb42-184" aria-hidden="true" tabindex="-1"></a>    strength <span class="op">=</span> <span class="st">&quot;strong&quot;</span></span>
<span id="cb42-185"><a href="#cb42-185" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">abs</span>(pearson_r) <span class="op">&gt;</span> <span class="fl">0.3</span>:</span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a>    strength <span class="op">=</span> <span class="st">&quot;moderate&quot;</span></span>
<span id="cb42-187"><a href="#cb42-187" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb42-188"><a href="#cb42-188" aria-hidden="true" tabindex="-1"></a>    strength <span class="op">=</span> <span class="st">&quot;weak&quot;</span></span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a>direction <span class="op">=</span> <span class="st">&quot;positive&quot;</span> <span class="cf">if</span> pearson_r <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">&quot;negative&quot;</span></span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;This indicates a **</span><span class="sc">{</span>strength<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>direction<span class="sc">}</span><span class="ss"> linear relationship** between production emissions (SEF) and logistics emissions (MEF).&quot;</span>)</span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pearson_p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;The correlation is **statistically significant** (p &lt; 0.05).&quot;</span>)</span>
<span id="cb42-194"><a href="#cb42-194" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb42-195"><a href="#cb42-195" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;The correlation is **not statistically significant** (p ≥ 0.05).&quot;</span>)</span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">The Spearman correlation is </span><span class="sc">{</span>spearman_rho<span class="sc">:.3f}</span><span class="ss">. The difference between Pearson and Spearman is </span><span class="sc">{</span><span class="bu">abs</span>(pearson_r <span class="op">-</span> spearman_rho)<span class="sc">:.3f}</span><span class="ss">.&quot;</span>)</span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">abs</span>(pearson_r <span class="op">-</span> spearman_rho) <span class="op">&gt;</span> <span class="fl">0.1</span>:</span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;This difference suggests the relationship may be influenced by outliers or is non-linear. The hexbin plot helps visualize density.&quot;</span>)</span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;The similarity suggests the relationship is largely linear and robust to outliers.&quot;</span>)</span>
<span id="cb42-202"><a href="#cb42-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-203"><a href="#cb42-203" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Business Implication ---&quot;</span>)</span>
<span id="cb42-204"><a href="#cb42-204" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pearson_r <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb42-205"><a href="#cb42-205" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;**Strong Positive Correlation**: Products with high production emissions also tend to have high logistics emissions.&quot;</span>)</span>
<span id="cb42-206"><a href="#cb42-206" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;→ **Strategy**: Decarbonization efforts should target both stages simultaneously for the most emission-intensive products. &quot;</span></span>
<span id="cb42-207"><a href="#cb42-207" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;Prioritize sectors at the top-right of the scatter plot for integrated supplier engagement programs.&quot;</span>)</span>
<span id="cb42-208"><a href="#cb42-208" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> pearson_r <span class="op">&gt;</span> <span class="fl">0.3</span>:</span>
<span id="cb42-209"><a href="#cb42-209" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;**Moderate Positive Correlation**: Production and logistics emissions are related but not strongly coupled.&quot;</span>)</span>
<span id="cb42-210"><a href="#cb42-210" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;→ **Strategy**: Companies should evaluate them separately. Hotspot analysis may reveal sectors that are &#39;production-heavy&#39; vs. &#39;logistics-heavy&#39;, allowing for tailored interventions.&quot;</span>)</span>
<span id="cb42-211"><a href="#cb42-211" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb42-212"><a href="#cb42-212" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;**Weak or Negligible Correlation**: Production and logistics emissions are largely independent.&quot;</span>)</span>
<span id="cb42-213"><a href="#cb42-213" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;→ **Strategy**: Supply chain decarbonization must address production and transportation as separate challenges. &quot;</span></span>
<span id="cb42-214"><a href="#cb42-214" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;A sector&#39;s production footprint does not predict its logistics footprint, so both must be measured directly.&quot;</span>)</span>
<span id="cb42-215"><a href="#cb42-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-216"><a href="#cb42-216" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Conclusion for RQ2 ---&quot;</span>)</span>
<span id="cb42-217"><a href="#cb42-217" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;The analysis quantifies the relationship between SEF and MEF. The findings directly inform the &#39;Analyze&#39; objective in the synopsis, &quot;</span></span>
<span id="cb42-218"><a href="#cb42-218" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;revealing whether emission-intensive products also carry emission-intensive logistics. This insight guides whether to integrate or separate decarbonization strategies for production and transportation.&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>============================================================
RQ2: Margin Correlation Analysis
============================================================

--- Data Overview (df_CO2) ---
df_CO2 shape: (1016, 8)

First 5 rows of df_CO2:
   2017 NAICS Code                  2017 NAICS Title       GHG  \
0           111110                   Soybean Farming  All GHGs   
1           111120  Oilseed (except Soybean) Farming  All GHGs   
2           111130          Dry Pea and Bean Farming  All GHGs   
3           111140                     Wheat Farming  All GHGs   
4           111150                      Corn Farming  All GHGs   

                                Unit  \
0  kg CO2e/2022 USD, purchaser price   
1  kg CO2e/2022 USD, purchaser price   
2  kg CO2e/2022 USD, purchaser price   
3  kg CO2e/2022 USD, purchaser price   
4  kg CO2e/2022 USD, purchaser price   

   Supply Chain Emission Factors without Margins  \
0                                          0.488   
1                                          0.488   
2                                          0.809   
3                                          0.809   
4                                          0.809   

   Margins of Supply Chain Emission Factors  \
0                                     0.044   
1                                     0.044   
2                                     0.040   
3                                     0.040   
4                                     0.040   

   Supply Chain Emission Factors with Margins Reference USEEIO Code  
0                                       0.532                1111A0  
1                                       0.532                1111A0  
2                                       0.848                1111B0  
3                                       0.848                1111B0  
4                                       0.848                1111B0  

Column names in df_CO2:
[&#39;2017 NAICS Code&#39;, &#39;2017 NAICS Title&#39;, &#39;GHG&#39;, &#39;Unit&#39;, &#39;Supply Chain Emission Factors without Margins&#39;, &#39;Margins of Supply Chain Emission Factors&#39;, &#39;Supply Chain Emission Factors with Margins&#39;, &#39;Reference USEEIO Code&#39;]

Using SEF column: &#39;Supply Chain Emission Factors without Margins&#39;
Using MEF column: &#39;Margins of Supply Chain Emission Factors&#39;

Number of valid observations after cleaning: 1016
This should be close to the expected 1,016 commodities.

Sanity check: max difference between (SEF+MEF) and &#39;Supply Chain Emission Factors with Margins&#39;: 1.00e-03 (should be near zero).

--- Descriptive Statistics ---
SEF (Supply Chain Emission Factor without Margins):
count    1016.000000
mean        0.264994
std         0.314768
min         0.026000
25%         0.103000
50%         0.159000
75%         0.302250
max         3.846000
Name: Supply Chain Emission Factors without Margins, dtype: float64

MEF (Margin Emission Factor):
count    1016.000000
mean        0.016945
std         0.023367
min         0.000000
25%         0.000000
50%         0.000000
75%         0.030250
max         0.125000
Name: Margins of Supply Chain Emission Factors, dtype: float64

--- Assumption Checks ---
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/b258ab73b2ec04322ffa67eef934ed54d5fae7c4.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>
Normality Tests (Shapiro-Wilk):
SEF: statistic=0.6063, p-value=0.0000
MEF: statistic=0.7474, p-value=0.0000
Note: Low p-values indicate non-normality, common in economic data. Pearson correlation is robust with large N.
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/6294c59b21253f7076350c8892184608b067aa99.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>
Number of potential outliers (|Z|&gt;3 in either variable): 23
These outliers represent extreme sectors (e.g., cement, agriculture) and are valid data points.

============================================================
CORE CORRELATION ANALYSIS
============================================================

Pearson correlation: r = 0.2498, p-value = 0.0000
Spearman correlation: ρ = 0.3673, p-value = 0.0000
95% Confidence Interval for Pearson r: [0.1912, 0.3066]

--- Generating Enhanced Plots ---
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/606d41867093350ff2837d3d99c953b5bda08320.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/dbb495225c6d86fd1cfabe7f1b7bdec62e72cb9c.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/da906429e10709a6d8e7abeba04f9f6153518dc2.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>
============================================================
INTERPRETATION &amp; BUSINESS IMPLICATIONS
============================================================

The Pearson correlation coefficient is 0.250.
This indicates a **weak positive linear relationship** between production emissions (SEF) and logistics emissions (MEF).
The correlation is **statistically significant** (p &lt; 0.05).

The Spearman correlation is 0.367. The difference between Pearson and Spearman is 0.118.
This difference suggests the relationship may be influenced by outliers or is non-linear. The hexbin plot helps visualize density.

--- Business Implication ---
**Weak or Negligible Correlation**: Production and logistics emissions are largely independent.
→ **Strategy**: Supply chain decarbonization must address production and transportation as separate challenges. A sector&#39;s production footprint does not predict its logistics footprint, so both must be measured directly.

--- Conclusion for RQ2 ---
The analysis quantifies the relationship between SEF and MEF. The findings directly inform the &#39;Analyze&#39; objective in the synopsis, revealing whether emission-intensive products also carry emission-intensive logistics. This insight guides whether to integrate or separate decarbonization strategies for production and transportation.
</code></pre>
</div>
</div>
<div class="cell markdown" id="VtIMMDSJJv24">
<p>#<strong>Research Question 3: Predictive Modelling from GHG
Profiles</strong></p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="OkOppvXfhPP2" data-outputId="b653b043-9464-41a7-91bb-8716b0a04b59">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">Research Question 3: Predictive Modeling from GHG Profiles</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score, RandomizedSearchCV</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, mean_absolute_error</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&#39;ignore&#39;</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set visual style</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&#39;whitegrid&#39;</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">&#39;figure.figsize&#39;</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">6</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Columns in GHG sheet:</span><span class="ch">\n</span><span class="st">&quot;</span>, df_GHG.columns.tolist())</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Columns in CO2 sheet:</span><span class="ch">\n</span><span class="st">&quot;</span>, df_CO2.columns.tolist())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Columns in GHG sheet:
 [&#39;2017 NAICS Code&#39;, &#39;2017 NAICS Title&#39;, &#39;GHG&#39;, &#39;Unit&#39;, &#39;Supply Chain Emission Factors without Margins&#39;, &#39;Margins of Supply Chain Emission Factors&#39;, &#39;Supply Chain Emission Factors with Margins&#39;, &#39;Reference USEEIO Code&#39;, &#39;NAICS_Sector&#39;, &#39;Sector&#39;, &#39;GHG_Category&#39;, &#39;Margin_Ratio&#39;, &#39;sector&#39;]

Columns in CO2 sheet:
 [&#39;2017 NAICS Code&#39;, &#39;2017 NAICS Title&#39;, &#39;GHG&#39;, &#39;Unit&#39;, &#39;Supply Chain Emission Factors without Margins&#39;, &#39;Margins of Supply Chain Emission Factors&#39;, &#39;Supply Chain Emission Factors with Margins&#39;, &#39;Reference USEEIO Code&#39;]
</code></pre>
</div>
</div>
<section id="aggregate-detailed-ghg-data" class="cell markdown"
id="uFPYz7ibiDjP">
<h2>Aggregate detailed GHG data</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="ChpvfszqhbuK" data-outputId="f6007efc-552b-41f2-ec42-36f4e1144e02">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#============================================================</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Identify correct column names (adjust based on print output)</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>naics_col <span class="op">=</span> <span class="st">&#39;2017 NAICS Code&#39;</span>           <span class="co"># column with NAICS code</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>sef_col   <span class="op">=</span> <span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>  <span class="co"># column with the intensity (kg/2022 USD)</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># If your CO2 sheet uses different names, replace the strings above accordingly.</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># For example, if it has &#39;total_sef&#39;, use that.</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Aggregate detailed GHG data</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define all F‑gas names (you can also generate this list dynamically from unique GHG values)</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>f_gas_list <span class="op">=</span> [</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;HFC-23&#39;</span>, <span class="st">&#39;HFC-236fa&#39;</span>, <span class="st">&#39;HFC-32&#39;</span>, <span class="st">&#39;HFC-125&#39;</span>, <span class="st">&#39;HFC-134a&#39;</span>, <span class="st">&#39;HFC-143a&#39;</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;HFCs and PFCs, unspecified&#39;</span>, <span class="st">&#39;Carbon tetrafluoride&#39;</span>, <span class="st">&#39;Hexafluoroethane&#39;</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Nitrogen trifluoride&#39;</span>, <span class="st">&#39;Perfluorobutane&#39;</span>, <span class="st">&#39;Perfluorocyclobutane&#39;</span>,</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Perfluorohexane&#39;</span>, <span class="st">&#39;Perfluoropropane&#39;</span>, <span class="st">&#39;Sulfur hexafluoride&#39;</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Total CH₄</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>ch4 <span class="op">=</span> df_GHG[df_GHG[<span class="st">&#39;GHG&#39;</span>] <span class="op">==</span> <span class="st">&#39;Methane&#39;</span>] <span class="op">\</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    .groupby(naics_col)[sef_col].<span class="bu">sum</span>().reset_index()</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>ch4.columns <span class="op">=</span> [naics_col, <span class="st">&#39;total_ch4&#39;</span>]</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Total N₂O</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>n2o <span class="op">=</span> df_GHG[df_GHG[<span class="st">&#39;GHG&#39;</span>] <span class="op">==</span> <span class="st">&#39;Nitrous oxide&#39;</span>] <span class="op">\</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>    .groupby(naics_col)[sef_col].<span class="bu">sum</span>().reset_index()</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>n2o.columns <span class="op">=</span> [naics_col, <span class="st">&#39;total_n2o&#39;</span>]</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Total F‑gases</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>fgas <span class="op">=</span> df_GHG[df_GHG[<span class="st">&#39;GHG&#39;</span>].isin(f_gas_list)] <span class="op">\</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>    .groupby(naics_col)[sef_col].<span class="bu">sum</span>().reset_index()</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>fgas.columns <span class="op">=</span> [naics_col, <span class="st">&#39;total_fgases&#39;</span>]</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Prepare the model data frame from the CO2 sheet</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the NAICS code and the total CO₂e column (may be named &#39;total_sef&#39; or something else)</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the column name below to match your CO2 sheet.</span></span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>model_df <span class="op">=</span> df_CO2[[naics_col, sef_col]].copy()</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>model_df.rename(columns<span class="op">=</span>{sef_col: <span class="st">&#39;total_co2e&#39;</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the three aggregated predictors</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>model_df <span class="op">=</span> model_df.merge(ch4, on<span class="op">=</span>naics_col, how<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>model_df <span class="op">=</span> model_df.merge(n2o, on<span class="op">=</span>naics_col, how<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>model_df <span class="op">=</span> model_df.merge(fgas, on<span class="op">=</span>naics_col, how<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill any missing values (should be none, but safe)</span></span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>model_df.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Model dataset shape: </span><span class="sc">{</span>model_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_df.head())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model dataset shape: (1016, 5)
   2017 NAICS Code  total_co2e  total_ch4  total_n2o  total_fgases
0           111110       0.488   0.000331    0.00130      0.000358
1           111120       0.488   0.000331    0.00130      0.000358
2           111130       0.809   0.003840    0.00199      0.000384
3           111140       0.809   0.003840    0.00199      0.000384
4           111150       0.809   0.003840    0.00199      0.000384
</code></pre>
</div>
</div>
<section id="model-building---train--test-split" class="cell markdown"
id="PUYMaXm0iIPO">
<h2>Model Building - Train / test split</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="8H3S6UqtiHem" data-outputId="92cab202-7298-4f95-b7ea-751ae7e0a8d7">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">&#39;total_ch4&#39;</span>, <span class="st">&#39;total_n2o&#39;</span>, <span class="st">&#39;total_fgases&#39;</span>]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> model_df[features]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model_df[<span class="st">&#39;total_co2e&#39;</span>]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Training set size: </span><span class="sc">{</span>X_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Test set size: </span><span class="sc">{</span>X_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Training set size: 812
Test set size: 204
</code></pre>
</div>
</div>
<section id="baseline-random-forest" class="cell markdown"
id="pjUfcm75iQhc">
<h2>Baseline Random Forest</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="5jMooN_SgDfz" data-outputId="36713370-b8ce-4810-d2ea-73398e0f9d47">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>rf_base <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>rf_base.fit(X_train, y_train)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>y_pred_base <span class="op">=</span> rf_base.predict(X_test)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;--- Baseline Random Forest ---&quot;</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R²  = </span><span class="sc">{</span>r2_score(y_test, y_pred_base)<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MAE = </span><span class="sc">{</span>mean_absolute_error(y_test, y_pred_base)<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;RMSE= </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mean_squared_error(y_test, y_pred_base))<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>--- Baseline Random Forest ---
R²  = 0.9461
MAE = 0.0261
RMSE= 0.0678
</code></pre>
</div>
</div>
<section id="hyperparameter-tuning-with-randomizedsearchcv"
class="cell markdown" id="PIIWAeLBiXWB">
<h2>Hyperparameter tuning with RandomizedSearchCV</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="J2ZMG--jgDZq" data-outputId="63e3ccb6-116f-45c2-8706-05f3d59a1b51">
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>param_dist <span class="op">=</span> {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;n_estimators&#39;</span>: [<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> np.linspace(<span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">10</span>)],</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_depth&#39;</span>: [<span class="bu">int</span>(x) <span class="cf">for</span> x <span class="kw">in</span> np.linspace(<span class="dv">10</span>, <span class="dv">110</span>, <span class="dv">11</span>)] <span class="op">+</span> [<span class="va">None</span>],</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;min_samples_split&#39;</span>: [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">14</span>],</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;min_samples_leaf&#39;</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>],</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_features&#39;</span>: [<span class="st">&#39;sqrt&#39;</span>, <span class="st">&#39;log2&#39;</span>, <span class="va">None</span>]</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>rf_tune <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>random_search <span class="op">=</span> RandomizedSearchCV(</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>rf_tune,</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    param_distributions<span class="op">=</span>param_dist,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    n_iter<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">&#39;r2&#39;</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>random_search.fit(X_train, y_train)</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best parameters:&quot;</span>, random_search.best_params_)</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Best CV R² :&quot;</span>, random_search.best_score_)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Fitting 5 folds for each of 50 candidates, totalling 250 fits
Best parameters: {&#39;n_estimators&#39;: 366, &#39;min_samples_split&#39;: 10, &#39;min_samples_leaf&#39;: 1, &#39;max_features&#39;: &#39;log2&#39;, &#39;max_depth&#39;: 80}
Best CV R² : 0.6983986573282975
</code></pre>
</div>
</div>
<section id="evaluate-the-tuned-model-on-the-test-set"
class="cell markdown" id="VJkKruvaidRu">
<h2>Evaluate the tuned model on the test set</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="ZfPl3q-8ihnE" data-outputId="adb655a6-a9a4-4da9-fd8f-8eb8d95180bb">
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>best_rf <span class="op">=</span> random_search.best_estimator_</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>y_pred_tuned <span class="op">=</span> best_rf.predict(X_test)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">--- Tuned Random Forest ---&quot;</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;R²  = </span><span class="sc">{</span>r2_score(y_test, y_pred_tuned)<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;MAE = </span><span class="sc">{</span>mean_absolute_error(y_test, y_pred_tuned)<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;RMSE= </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mean_squared_error(y_test, y_pred_tuned))<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
--- Tuned Random Forest ---
R²  = 0.8984
MAE = 0.0428
RMSE= 0.0931
</code></pre>
</div>
</div>
<section id="model-interpretation---feature-importance"
class="cell markdown" id="361QPYlNi3RC">
<h2>Model Interpretation - Feature importance</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:479}"
id="T9_0jRyZi_AV" data-outputId="085d03b4-1189-4473-b36a-e2ff0aee409d">
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> best_rf.feature_importances_</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>feat_imp <span class="op">=</span> pd.DataFrame({<span class="st">&#39;feature&#39;</span>: features, <span class="st">&#39;importance&#39;</span>: importances}) <span class="op">\</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>            .sort_values(<span class="st">&#39;importance&#39;</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(feat_imp)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>feat_imp, x<span class="op">=</span><span class="st">&#39;importance&#39;</span>, y<span class="op">=</span><span class="st">&#39;feature&#39;</span>, palette<span class="op">=</span><span class="st">&#39;viridis&#39;</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Feature Importance for Predicting Total CO₂e&#39;</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>        feature  importance
0     total_ch4    0.497636
1     total_n2o    0.353167
2  total_fgases    0.149197
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/7b595fca0e2247a08cb1b54f6ccb384e27584cdf.png" /></p>
</div>
</div>
<section id="actual-vs-predicted-plot" class="cell markdown"
id="esigG2jjjFHd">
<h2>Actual vs. predicted plot</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:607}"
id="t5bsj9VYjGVi" data-outputId="7248c790-112b-4840-f212-b6cdb5d9e757">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(y_test, y_pred_tuned, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolors<span class="op">=</span><span class="st">&#39;k&#39;</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>plt.plot([y_test.<span class="bu">min</span>(), y_test.<span class="bu">max</span>()], [y_test.<span class="bu">min</span>(), y_test.<span class="bu">max</span>()], <span class="st">&#39;r--&#39;</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Actual Total CO₂e&#39;</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Predicted Total CO₂e&#39;</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Actual vs. Predicted (Tuned Random Forest)&#39;</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/7922004521b83d78cc7f7174cfb066eb34b0a589.png" /></p>
</div>
</div>
<section id="residual-analysis" class="cell markdown" id="AacTGOOQjN0i">
<h2>Residual analysis</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:359}"
id="wy81Xq-yjPDv" data-outputId="f011279d-1164-4856-ff62-3fe5a0232a38">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> y_test <span class="op">-</span> y_pred_tuned</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].scatter(y_pred_tuned, residuals, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolors<span class="op">=</span><span class="st">&#39;k&#39;</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&#39;r&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">&#39;Predicted Total CO₂e&#39;</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">&#39;Residuals&#39;</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">&#39;Residual Plot&#39;</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].hist(residuals, bins<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">&#39;k&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">&#39;Residuals&#39;</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">&#39;Frequency&#39;</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">&#39;Distribution of Residuals&#39;</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/20b91bba1f19acdb12887ec775fac2da47a1c9c4.png" /></p>
</div>
</div>
<div class="cell markdown" id="JQEmkTuNLYUe">
<p>#<strong>Research Question 4: Unsupervised Carbon Risk
Clustering</strong></p>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:224}"
id="8uAmSDARgDT8" data-outputId="29a9e801-783f-48d9-cd4a-58d4aea967ef">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co">Research Question 4: Unsupervised Carbon Risk Clustering</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_score</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Define GWP values (CO2e = kg_gas * GWP)</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>gwp <span class="op">=</span> {</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Carbon dioxide&#39;</span>: <span class="dv">1</span>,</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Methane&#39;</span>: <span class="dv">28</span>,</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Nitrous oxide&#39;</span>: <span class="dv">265</span>,</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;HFCs and PFCs, unspecified&#39;</span>: <span class="dv">1</span>      <span class="co"># already in CO2e</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to the gases we will use</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>gas_list <span class="op">=</span> <span class="bu">list</span>(gwp.keys())</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df_GHG[df_GHG[<span class="st">&#39;GHG&#39;</span>].isin(gas_list)].copy()</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to CO2e</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>df_filtered[<span class="st">&#39;sef_co2e&#39;</span>] <span class="op">=</span> df_filtered[<span class="st">&#39;Supply Chain Emission Factors without Margins&#39;</span>] <span class="op">*</span> df_filtered[<span class="st">&#39;GHG&#39;</span>].<span class="bu">map</span>(gwp)</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>df_filtered[<span class="st">&#39;mef_co2e&#39;</span>] <span class="op">=</span> df_filtered[<span class="st">&#39;Margins of Supply Chain Emission Factors&#39;</span>] <span class="op">*</span> df_filtered[<span class="st">&#39;GHG&#39;</span>].<span class="bu">map</span>(gwp)</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate per NAICS code</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>cluster_df <span class="op">=</span> df_filtered.groupby(<span class="st">&#39;2017 NAICS Code&#39;</span>).agg({</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;sef_co2e&#39;</span>: <span class="st">&#39;sum&#39;</span>,</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;mef_co2e&#39;</span>: <span class="st">&#39;sum&#39;</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep NAICS title for interpretation (first occurrence)</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>titles <span class="op">=</span> df_filtered.groupby(<span class="st">&#39;2017 NAICS Code&#39;</span>)[<span class="st">&#39;2017 NAICS Title&#39;</span>].first()</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>cluster_df <span class="op">=</span> cluster_df.merge(titles, on<span class="op">=</span><span class="st">&#39;2017 NAICS Code&#39;</span>, how<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the aggregated data</span></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Aggregated data shape:&quot;</span>, cluster_df.shape)</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>cluster_df.head()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Aggregated data shape: (1016, 4)
</code></pre>
</div>
<div class="output execute_result" data-execution_count="35">

  <div id="df-1128ef3e-c915-4d0e-87ed-1cc125844c33" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2017 NAICS Code</th>
      <th>sef_co2e</th>
      <th>mef_co2e</th>
      <th>2017 NAICS Title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>111110</td>
      <td>0.488126</td>
      <td>0.043563</td>
      <td>Soybean Farming</td>
    </tr>
    <tr>
      <th>1</th>
      <td>111120</td>
      <td>0.488126</td>
      <td>0.043563</td>
      <td>Oilseed (except Soybean) Farming</td>
    </tr>
    <tr>
      <th>2</th>
      <td>111130</td>
      <td>0.808254</td>
      <td>0.039254</td>
      <td>Dry Pea and Bean Farming</td>
    </tr>
    <tr>
      <th>3</th>
      <td>111140</td>
      <td>0.808254</td>
      <td>0.039254</td>
      <td>Wheat Farming</td>
    </tr>
    <tr>
      <th>4</th>
      <td>111150</td>
      <td>0.808254</td>
      <td>0.039254</td>
      <td>Corn Farming</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-1128ef3e-c915-4d0e-87ed-1cc125844c33')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-1128ef3e-c915-4d0e-87ed-1cc125844c33 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-1128ef3e-c915-4d0e-87ed-1cc125844c33');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    </div>
  </div>

</div>
</div>
<section id="data-scaling-and-exploration" class="cell markdown"
id="5xr8YcuWk8gA">
<h2>Data Scaling and Exploration</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:447}"
id="yo97-b-ak9Y8" data-outputId="ef569959-bc5e-42a1-d8f5-e5b1639e6006">
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Standardize the features</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> cluster_df[[<span class="st">&#39;sef_co2e&#39;</span>, <span class="st">&#39;mef_co2e&#39;</span>]]</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>features_scaled <span class="op">=</span> scaler.fit_transform(features)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick check of distributions after scaling</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>sns.histplot(features_scaled[:,<span class="dv">0</span>], kde<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">&#39;Standardized SEF&#39;</span>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>sns.histplot(features_scaled[:,<span class="dv">1</span>], kde<span class="op">=</span><span class="va">True</span>).set_title(<span class="st">&#39;Standardized MEF&#39;</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/19fb5367fe946c3964b13af4a9e0158566775d8b.png" /></p>
</div>
</div>
<section id="determining-the-optimal-number-of-clusters"
class="cell markdown" id="B-fkBcfslEEp">
<h2>Determining the Optimal Number of Clusters</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:359}"
id="opMOSxqflGKh" data-outputId="54a107ae-09e6-4204-f22e-807c16bf0527">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Find optimal k using elbow and silhouette</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>wcss <span class="op">=</span> []</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>silhouette_scores <span class="op">=</span> []</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>K_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> K_range:</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">42</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> kmeans.fit_predict(features_scaled)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    wcss.append(kmeans.inertia_)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    silhouette_scores.append(silhouette_score(features_scaled, labels))</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both metrics</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">4</span>))</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(K_range, wcss, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">&#39;Number of clusters (k)&#39;</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">&#39;WCSS&#39;</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">&#39;Elbow Method&#39;</span>)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(K_range, silhouette_scores, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, color<span class="op">=</span><span class="st">&#39;orange&#39;</span>)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">&#39;Number of clusters (k)&#39;</span>)</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">&#39;Silhouette Score&#39;</span>)</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">&#39;Silhouette Score&#39;</span>)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>)</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/552001786f2831e06ede2742c3ef53241d9aa9d6.png" /></p>
</div>
</div>
<section id="kmeans-clustering-with-k--4" class="cell markdown"
id="B-o3Ed-2lMP1">
<h2>K‑Means Clustering with k = 4</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:193}"
id="aliWzfaNlN-D" data-outputId="f43a1404-9b6f-46f1-f7d2-77250e1730e8">
<div class="sourceCode" id="cb67"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Apply K-Means with k = 4</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, random_state<span class="op">=</span><span class="dv">42</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>cluster_labels <span class="op">=</span> kmeans.fit_predict(features_scaled)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster labels to the original dataframe</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>cluster_df[<span class="st">&#39;Cluster&#39;</span>] <span class="op">=</span> cluster_labels</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine cluster centers (in original scale for interpretation)</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>centers_scaled <span class="op">=</span> kmeans.cluster_centers_</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>centers_original <span class="op">=</span> scaler.inverse_transform(centers_scaled)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>centers_df <span class="op">=</span> pd.DataFrame(centers_original,</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>                          columns<span class="op">=</span>[<span class="st">&#39;SEF_center&#39;</span>, <span class="st">&#39;MEF_center&#39;</span>])</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>centers_df[<span class="st">&#39;Cluster&#39;</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">4</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Cluster centers (original units – kg CO₂e / USD):&quot;</span>)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>centers_df</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Cluster centers (original units – kg CO₂e / USD):
</code></pre>
</div>
<div class="output execute_result" data-execution_count="38">

  <div id="df-661493f5-f2c4-4b55-9629-2ff719c60889" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SEF_center</th>
      <th>MEF_center</th>
      <th>Cluster</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.261744</td>
      <td>0.044894</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.155889</td>
      <td>0.002820</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.096957</td>
      <td>0.052947</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.954583</td>
      <td>0.024081</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-661493f5-f2c4-4b55-9629-2ff719c60889')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-661493f5-f2c4-4b55-9629-2ff719c60889 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-661493f5-f2c4-4b55-9629-2ff719c60889');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


  <div id="id_acf345a0-935a-4a94-b71e-972e58fffef0">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('centers_df')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_acf345a0-935a-4a94-b71e-972e58fffef0 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('centers_df');
      }
      })();
    </script>
  </div>

    </div>
  </div>

</div>
</div>
<section id="visualising-the-clusters" class="cell markdown"
id="jDNnjGBUla96">
<h2>Visualising the Clusters</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:807}"
id="dD3qrjPxlc6V" data-outputId="c9c113c0-66d9-45be-a4d5-9dcc82308d1b">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Visualize clusters</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> plt.scatter(cluster_df[<span class="st">&#39;sef_co2e&#39;</span>],</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                      cluster_df[<span class="st">&#39;mef_co2e&#39;</span>],</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                      c<span class="op">=</span>cluster_df[<span class="st">&#39;Cluster&#39;</span>],</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>                      cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>,</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>                      alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>                      edgecolors<span class="op">=</span><span class="st">&#39;k&#39;</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>                      linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Supply Chain Emission Factor (SEF) [kg CO₂e / USD]&#39;</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Margin Emission Factor (MEF) [kg CO₂e / USD]&#39;</span>)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;K-Means Clustering of U.S. Commodities (k=4)&#39;</span>)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark cluster centers</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>centers <span class="op">=</span> plt.scatter(centers_original[:,<span class="dv">0</span>],</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>                      centers_original[:,<span class="dv">1</span>],</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>                      marker<span class="op">=</span><span class="st">&#39;X&#39;</span>,</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>                      s<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>                      c<span class="op">=</span><span class="st">&#39;red&#39;</span>,</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>                      edgecolors<span class="op">=</span><span class="st">&#39;white&#39;</span>,</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>                      linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>                      label<span class="op">=</span><span class="st">&#39;Cluster Centers&#39;</span>)</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>[scatter, centers], labels<span class="op">=</span>[<span class="st">&#39;Commodities&#39;</span>, <span class="st">&#39;Centers&#39;</span>])</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_e1e5c85ad4d442d7b364747f1877f1eb/af8e30afb101b5731348dfe283490737b1bb04e8.png" /></p>
</div>
</div>
<section id="profiling-the-clusters" class="cell markdown"
id="Muwbug2xlhQA">
<h2>Profiling the Clusters</h2>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="OKf3L_fFljII" data-outputId="9c9e02b6-a375-46f0-df4d-5a444e43ee6a">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Profile clusters – show top industries per cluster</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cl <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">--- Cluster </span><span class="sc">{</span>cl<span class="sc">}</span><span class="ss"> ---&quot;</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cluster_df[cluster_df[<span class="st">&#39;Cluster&#39;</span>] <span class="op">==</span> cl][[<span class="st">&#39;2017 NAICS Title&#39;</span>, <span class="st">&#39;sef_co2e&#39;</span>, <span class="st">&#39;mef_co2e&#39;</span>]].head(<span class="dv">10</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>
--- Cluster 0 ---
                                 2017 NAICS Title  sef_co2e  mef_co2e
                                  Soybean Farming  0.488126  0.043563
                 Oilseed (except Soybean) Farming  0.488126  0.043563
                                   Potato Farming  0.589968  0.040012
Other Vegetable (except Potato) and Melon Farming  0.589968  0.040012
                                    Orange Groves  0.427538  0.058691
                    Citrus (except Orange) Groves  0.427538  0.058691
                                   Apple Orchards  0.427538  0.058691
                                  Grape Vineyards  0.427538  0.058691
                               Strawberry Farming  0.427538  0.058691
                Berry (except Strawberry) Farming  0.427538  0.058691

--- Cluster 1 ---
                                   2017 NAICS Title  sef_co2e  mef_co2e
                                     Cotton Ginning  0.383243       0.0
        Soil Preparation, Planting, and Cultivating  0.383243       0.0
              Crop Harvesting, Primarily by Machine  0.383243       0.0
Postharvest Crop Activities (except Cotton Ginning)  0.383243       0.0
            Farm Labor Contractors and Crew Leaders  0.383243       0.0
                           Farm Management Services  0.383243       0.0
           Support Activities for Animal Production  0.383243       0.0
                    Support Activities for Forestry  0.383243       0.0
                         Drilling Oil and Gas Wells  0.404977       0.0
      Support Activities for Oil and Gas Operations  0.371059       0.0

--- Cluster 2 ---
                        2017 NAICS Title  sef_co2e  mef_co2e
        Beef Cattle Ranching and Farming  2.847030  0.044743
                         Cattle Feedlots  2.847030  0.044743
Dual-Purpose Cattle Ranching and Farming  2.847030  0.044743
                    Cement Manufacturing  3.846739  0.077560

--- Cluster 3 ---
                     2017 NAICS Title  sef_co2e  mef_co2e
             Dry Pea and Bean Farming  0.808254  0.039254
                        Wheat Farming  0.808254  0.039254
                         Corn Farming  0.808254  0.039254
                         Rice Farming  0.808254  0.039254
Oilseed and Grain Combination Farming  0.808254  0.039254
              All Other Grain Farming  0.808254  0.039254
                      Tobacco Farming  0.703070  0.036532
                       Cotton Farming  0.703070  0.036532
                    Sugarcane Farming  0.703070  0.036532
                          Hay Farming  0.703070  0.036532
</code></pre>
</div>
</div>
</body>
</html>
